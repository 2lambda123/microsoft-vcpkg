From 22a8365dd158ef2695d31c732afb867ca8617817 Mon Sep 17 00:00:00 2001
From: quqiOnfree <quqiOnfree@outlook.com>
Date: Sat, 15 Jun 2024 23:27:38 +0800
Subject: [PATCH 2/9] Add install command

---
 CMakeLists.txt            | 26 ++++++++++++++++++++------
 CMakeSettings.json        | 24 +++++++++++++++++++++++-
 mariadbcppConfig.cmake.in | 10 ++++++++++
 3 files changed, 53 insertions(+), 7 deletions(-)
 create mode 100644 mariadbcppConfig.cmake.in

diff --git a/CMakeLists.txt b/CMakeLists.txt
index e1b9a05..66c1069 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -537,12 +537,26 @@ ENDIF()
 TARGET_LINK_LIBRARIES(${LIBRARY_NAME} ${MARIADB_CLIENT_TARGET_NAME} ${PLATFORM_DEPENDENCIES} unofficial::libmariadb)
 TARGET_LINK_LIBRARIES(${STATIC_LIBRARY_NAME} mariadbclient unofficial::libmariadb)
 
-ADD_DEPENDENCIES(${LIBRARY_NAME} DEPENDENCIES_FOR_PACKAGE)
-
-# Packaging
-MESSAGE(STATUS "License File: ${CPACK_RESOURCE_FILE_LICENSE}")
-MESSAGE(STATUS "ReadMe File: ${CPACK_PACKAGE_DESCRIPTION_FILE}")
-MESSAGE(STATUS "Source Package Filename: ${CPACK_SOURCE_PACKAGE_FILE_NAME}.${CPACK_SOURCE_GENERATOR}")
+# install
+
+install(TARGETS ${LIBRARY_NAME} ${STATIC_LIBRARY_NAME}
+        EXPORT ${LIBRARY_NAME}Targets 
+        LIBRARY DESTINATION lib
+        ARCHIVE DESTINATION lib
+        RUNTIME DESTINATION bin
+        PUBLIC_HEADER DESTINATION include
+        )
+
+install(EXPORT ${LIBRARY_NAME}Targets
+        FILE ${LIBRARY_NAME}Targets.cmake
+        NAMESPACE unofficial::
+        DESTINATION lib/cmake/${LIBRARY_NAME}
+        )
+
+configure_file(${LIBRARY_NAME}Config.cmake.in ${LIBRARY_NAME}Config.cmake @ONLY)
+install(FILES "${CMAKE_CURRENT_BINARY_DIR}/${LIBRARY_NAME}Config.cmake"
+        DESTINATION lib/cmake/${LIBRARY_NAME}
+        )
 
 # install_test/CMakeLists.txt configuration should go after packaging.cmake but before include(CPack). Since CPack included in packaging cmake,
 # that configuration has been moved there. For the same reason there also moved the message with package name
diff --git a/CMakeSettings.json b/CMakeSettings.json
index 0c5fbf9..dff902e 100644
--- a/CMakeSettings.json
+++ b/CMakeSettings.json
@@ -20,7 +20,29 @@
       "cmakeCommandArgs": "",
       "buildCommandArgs": "",
       "ctestCommandArgs": "",
-      "inheritEnvironments": [ "msvc_x64_x64" ],
+      "inheritEnvironments": [ "msvc_x64_x64" ]
+    },
+    {
+      "name": "x86-Debug",
+      "generator": "Ninja",
+      "configurationType": "Debug",
+      "buildRoot": "${projectDir}\\out\\build\\${name}",
+      "installRoot": "${projectDir}\\out\\install\\${name}",
+      "cmakeCommandArgs": "",
+      "buildCommandArgs": "",
+      "ctestCommandArgs": "",
+      "inheritEnvironments": [ "msvc_x86" ]
+    },
+    {
+      "name": "x86-Release",
+      "generator": "Ninja",
+      "configurationType": "RelWithDebInfo",
+      "buildRoot": "${projectDir}\\out\\build\\${name}",
+      "installRoot": "${projectDir}\\out\\install\\${name}",
+      "cmakeCommandArgs": "",
+      "buildCommandArgs": "",
+      "ctestCommandArgs": "",
+      "inheritEnvironments": [ "msvc_x86" ],
       "variables": []
     }
   ]
diff --git a/mariadbcppConfig.cmake.in b/mariadbcppConfig.cmake.in
new file mode 100644
index 0000000..4e15c75
--- /dev/null
+++ b/mariadbcppConfig.cmake.in
@@ -0,0 +1,10 @@
+﻿include(CMakeFindDependencyMacro)
+
+# 如果你的项目需要依赖其他的库，可以使用下面语句，用法与find_package相同
+# find_dependency(MYDEP REQUIRED)
+find_dependency(libmariadb CONFIG REQUIRED)
+
+# Any extra setup
+
+# Add the targets file
+include("${CMAKE_CURRENT_LIST_DIR}/mariadb-connector-cppTargets.cmake")
\ No newline at end of file
-- 
2.45.2.windows.1

