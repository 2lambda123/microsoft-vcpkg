From fe6fdd02612ddc780e7aacc80a47e2b023cfe68b Mon Sep 17 00:00:00 2001
From: quqiOnfree <quqiOnfree@outlook.com>
Date: Sun, 16 Jun 2024 01:04:41 +0800
Subject: [PATCH 6/9] add include

---
 CMakeLists.txt | 17 ++++-------------
 1 file changed, 4 insertions(+), 13 deletions(-)

diff --git a/CMakeLists.txt b/CMakeLists.txt
index 630a5ab..3994146 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -457,18 +457,9 @@ INCLUDE_DIRECTORIES(${STATIC_LIBRARY_NAME}
     src
     class)
 
-ADD_LIBRARY(${LIBRARY_NAME}_obj OBJECT ${MACPP_SOURCES})
-TARGET_LINK_LIBRARIES(${LIBRARY_NAME}_obj PRIVATE unofficial::libmariadb)
-IF(UNIX)
-  SET_TARGET_PROPERTIES(${LIBRARY_NAME}_obj PROPERTIES COMPILE_FLAGS "${CMAKE_SHARED_LIBRARY_C_FLAGS}")
-ENDIF()
-SET(${LIBRARY_NAME}_OBJECTS $<TARGET_OBJECTS:${LIBRARY_NAME}_obj>)
-
 IF(WIN32 AND NOT MINGW)
-  ADD_LIBRARY(${LIBRARY_NAME} SHARED ${CMAKE_SOURCE_DIR}/src/maconncpp.rc ${${LIBRARY_NAME}_OBJECTS} ${CMAKE_SOURCE_DIR}/src/maconncpp.def)
-  ADD_LIBRARY(${STATIC_LIBRARY_NAME} STATIC ${${LIBRARY_NAME}_OBJECTS} ${CMAKE_SOURCE_DIR}/src/maconncpp.rc)
-
-  TARGET_COMPILE_DEFINITIONS(${LIBRARY_NAME}_obj PRIVATE "MARIADB_EXPORTED=__declspec(dllexport)")
+  ADD_LIBRARY(${LIBRARY_NAME} SHARED ${CMAKE_SOURCE_DIR}/src/maconncpp.rc ${MACPP_SOURCES} ${CMAKE_SOURCE_DIR}/src/maconncpp.def)
+  ADD_LIBRARY(${STATIC_LIBRARY_NAME} STATIC ${MACPP_SOURCES} ${CMAKE_SOURCE_DIR}/src/maconncpp.rc)
 
   TARGET_COMPILE_DEFINITIONS(${LIBRARY_NAME} PRIVATE "MARIADB_EXPORTED=__declspec(dllexport)")
   TARGET_COMPILE_DEFINITIONS(${LIBRARY_NAME} INTERFACE "MARIADB_EXPORTED=__declspec(dllimport)")
@@ -482,8 +473,8 @@ ELSE()
     SET(EMPTY_FILE ${CMAKE_BINARY_DIR}/empty.cpp)
   ENDIF()
   #  MESSAGE(STATUS "Version script: ${CMAKE_SOURCE_DIR}/src/maconncpp.def")
-  ADD_LIBRARY(${LIBRARY_NAME} SHARED ${${LIBRARY_NAME}_OBJECTS} ${EMPTY_FILE})
-  ADD_LIBRARY(${STATIC_LIBRARY_NAME} STATIC ${${LIBRARY_NAME}_OBJECTS} ${EMPTY_FILE})
+  ADD_LIBRARY(${LIBRARY_NAME} SHARED ${MACPP_SOURCES} ${EMPTY_FILE})
+  ADD_LIBRARY(${STATIC_LIBRARY_NAME} STATIC ${MACPP_SOURCES} ${EMPTY_FILE})
 
   IF(APPLE)
     SET_TARGET_PROPERTIES(${LIBRARY_NAME} PROPERTIES LINK_FLAGS "-Wl"
-- 
2.45.2.windows.1

