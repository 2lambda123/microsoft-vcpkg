diff --git a/src/tools/msvc/MSBuildProject.pm b/src/tools/msvc/MSBuildProject.pm
index f24d9e5..356cc31 100644
--- a/src/tools/msvc/MSBuildProject.pm
+++ b/src/tools/msvc/MSBuildProject.pm
@@ -81,13 +81,14 @@ EOF
   </PropertyGroup>
 EOF
 
+	my $maybe_dll = $self->{solution}->{options}->{VCPKG_CRT_LINKAGE} eq 'dynamic' ? "DLL" : '';
 	$self->WriteItemDefinitionGroup(
 		$f, 'Debug',
 		{
 			defs    => "_DEBUG;DEBUG=1",
 			opt     => 'Disabled',
 			strpool => 'false',
-			runtime => 'MultiThreadedDebugDLL'
+			runtime => 'MultiThreadedDebug' . $maybe_dll
 		});
 	$self->WriteItemDefinitionGroup(
 		$f,
@@ -96,7 +97,7 @@ EOF
 			defs    => "",
 			opt     => 'Full',
 			strpool => 'true',
-			runtime => 'MultiThreadedDLL'
+			runtime => 'MultiThreaded' . $maybe_dll
 		});
 	return;
 }
@@ -266,6 +267,8 @@ sub WriteConfigurationPropertyGroup
 	  ($self->{type} eq "exe")
 	  ? 'Application'
 	  : ($self->{type} eq "dll" ? 'DynamicLibrary' : 'StaticLibrary');
+	if ($self->{solution}->{options}->{VCPKG_LIBRARY_LINKAGE} eq 'static')
+	  { $cfgtype =~ s/DynamicLibrary/StaticLibrary/; }
 
 	print $f <<EOF;
   <PropertyGroup Condition="'\$(Configuration)|\$(Platform)'=='$cfgname|$self->{platform}'" Label="Configuration">
@@ -311,7 +314,9 @@ sub WriteItemDefinitionGroup
 	my $libs = $self->GetAdditionalLinkerDependencies($cfgname, ';');
 
 	my $targetmachine =
-	  $self->{platform} eq 'Win32' ? 'MachineX86' : 'MachineX64';
+	  'Machine' . uc($self->{platform});
+	$targetmachine =~ s/WIN32/X86/;
+	my $randomizebase = ($self->{platform} =~ /^ARM/) ? 'true' : 'false';
 
 	my $includes = join ';', @{ $self->{includes} }, "";
 
@@ -347,7 +352,7 @@ sub WriteItemDefinitionGroup
       <ProgramDatabaseFile>.\\$cfgname\\$self->{name}\\$self->{name}.pdb</ProgramDatabaseFile>
       <GenerateMapFile>false</GenerateMapFile>
       <MapFileName>.\\$cfgname\\$self->{name}\\$self->{name}.map</MapFileName>
-      <RandomizedBaseAddress>false</RandomizedBaseAddress>
+      <RandomizedBaseAddress>$randomizebase</RandomizedBaseAddress>
       <!-- Permit links to MinGW-built, 32-bit DLLs (default before VS2012). -->
       <ImageHasSafeExceptionHandlers/>
       <SubSystem>Console</SubSystem>
diff --git a/src/tools/msvc/Mkvcbuild.pm b/src/tools/msvc/Mkvcbuild.pm
index ef0a33c..ea07351 100644
--- a/src/tools/msvc/Mkvcbuild.pm
+++ b/src/tools/msvc/Mkvcbuild.pm
@@ -114,8 +114,10 @@ sub mkvcbuild
 
 	if ($vsVersion >= '9.00')
 	{
+		if ($solution->{platform} !~ /^ARM/) {
 		push(@pgportfiles, 'pg_crc32c_sse42_choose.c');
 		push(@pgportfiles, 'pg_crc32c_sse42.c');
+		}
 		push(@pgportfiles, 'pg_crc32c_sb8.c');
 	}
 	else
@@ -196,6 +198,7 @@ sub mkvcbuild
 		'syncrep_gram.y');
 	$postgres->AddFiles('src/backend/utils/adt', 'jsonpath_scan.l',
 		'jsonpath_gram.y');
+	($config->{VCPKG_LIBRARY_LINKAGE} eq 'dynamic') &&
 	$postgres->AddDefine('BUILDING_DLL');
 	$postgres->AddLibrary('secur32.lib');
 	$postgres->AddLibrary('ws2_32.lib');
diff --git a/src/tools/msvc/Solution.pm b/src/tools/msvc/Solution.pm
index 35126cd..63a4841 100644
--- a/src/tools/msvc/Solution.pm
+++ b/src/tools/msvc/Solution.pm
@@ -63,6 +63,11 @@ sub DeterminePlatform
 	my $self = shift;
 
 	if ($^O eq "MSWin32")
+	{
+		$self->{platform} = uc($self->{options}->{VCPKG_TARGET_ARCHITECTURE});
+		$self->{platform} =~ s/^X86$/Win32/;
+	}
+	elsif (0)
 	{
 		# Examine CL help output to determine if we are in 32 or 64-bit mode.
 		my $output = `cl /help 2>&1`;
@@ -148,7 +153,7 @@ sub GetOpenSSLVersion
 sub GenerateFiles
 {
 	my $self          = shift;
-	my $bits          = $self->{platform} eq 'Win32' ? 32 : 64;
+	my $bits          = $self->{platform} =~ /64/ ? 64 : 32;
 	my $ac_init_found = 0;
 	my $package_name;
 	my $package_version;
@@ -502,7 +507,7 @@ sub GenerateFiles
 		USE_PAM                    => undef,
 		USE_SLICING_BY_8_CRC32C    => undef,
 		USE_SSE42_CRC32C           => undef,
-		USE_SSE42_CRC32C_WITH_RUNTIME_CHECK => 1,
+		USE_SSE42_CRC32C_WITH_RUNTIME_CHECK => $self->{platform} =~ /^ARM/ ? undef : 1,
 		USE_SYSTEMD                         => undef,
 		USE_SYSV_SEMAPHORES                 => undef,
 		USE_SYSV_SHARED_MEMORY              => undef,
@@ -1060,7 +1065,7 @@ sub AddProject
 	if ($self->{options}->{icu})
 	{
 		$proj->AddIncludeDir($self->{options}->{icu} . '\include');
-		if ($self->{platform} eq 'Win32')
+		if (1)
 		{
 			$proj->AddLibrary($self->{options}->{icu} . '\lib\icuin.lib');
 			$proj->AddLibrary($self->{options}->{icu} . '\lib\icuuc.lib');
diff --git a/src/tools/msvc/gendef.pl b/src/tools/msvc/gendef.pl
index b8c514a..1fb7619 100644
--- a/src/tools/msvc/gendef.pl
+++ b/src/tools/msvc/gendef.pl
@@ -122,7 +122,7 @@ sub writedef
 
 		# Strip the leading underscore for win32, but not x64
 		$f =~ s/^_//
-		  unless ($platform eq "x64");
+		  if ($platform eq "Win32");
 
 		# Emit just the name if it's a function symbol, or emit the name
 		# decorated with the DATA option for variables.
@@ -150,7 +150,7 @@ sub usage
 usage()
   unless scalar(@ARGV) == 2
   && ( ($ARGV[0] =~ /\\([^\\]+$)/)
-	&& ($ARGV[1] eq 'Win32' || $ARGV[1] eq 'x64'));
+	&& ($ARGV[1] ne ''));
 my $defname  = uc $1;
 my $deffile  = "$ARGV[0]/$defname.def";
 my $platform = $ARGV[1];
