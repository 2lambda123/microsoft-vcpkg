diff -Nru -x '*~' OpenSP-1.5.2.orig/CMakeLists.txt OpenSP-1.5.2/CMakeLists.txt
--- OpenSP-1.5.2.orig/CMakeLists.txt	1970-01-01 02:00:00.000000000 +0200
+++ OpenSP-1.5.2/CMakeLists.txt	2014-08-24 17:23:19.941495700 +0300
@@ -0,0 +1,260 @@
+project(opensp)
+
+set (VERSION_MAJOR 1)
+set (VERSION_MINOR 5)
+set (VERSION_PATH 2)
+
+cmake_minimum_required(VERSION 2.6)
+
+include_directories(
+    .
+    include
+    generic
+)
+
+set (SRC_SOURCES
+    "lib/Allocator.cxx"
+    "lib/app_inst.cxx"
+    "lib/arc_inst.cxx"
+    "lib/ArcEngine.cxx"
+    "lib/assert.cxx"
+    "lib/Attribute.cxx"
+    "lib/Big5CodingSystem.cxx"
+    "lib/CharsetDecl.cxx"
+    "lib/CharsetInfo.cxx"
+    "lib/CharsetRegistry.cxx"
+    "lib/CmdLineApp.cxx"
+    "lib/CodingSystem.cxx"
+    "lib/CodingSystemKit.cxx"
+    "lib/ConsoleOutput.cxx"
+    "lib/ContentState.cxx"
+    "lib/ContentToken.cxx"
+    "lib/DescriptorManager.cxx"
+    "lib/Dtd.cxx"
+    "lib/ElementType.cxx"
+    "lib/Entity.cxx"
+    "lib/EntityApp.cxx"
+    "lib/EntityCatalog.cxx"
+    "lib/EntityDecl.cxx"
+    "lib/EntityManager.cxx"
+    "lib/entmgr_inst.cxx"
+    "lib/ErrnoMessageArg.cxx"
+    "lib/ErrorCountEventHandler.cxx"
+    "lib/EUCJPCodingSystem.cxx"
+    "lib/Event.cxx"
+    "lib/EventGenerator.cxx"
+    "lib/ExtendEntityManager.cxx"
+    "lib/ExternalId.cxx"
+    "lib/Fixed2CodingSystem.cxx"
+    "lib/GenericEventHandler.cxx"
+    "lib/Group.cxx"
+    "lib/Hash.cxx"
+    "lib/Id.cxx"
+    "lib/IdentityCodingSystem.cxx"
+    "lib/IListBase.cxx"
+    "lib/InputSource.cxx"
+    "lib/InternalInputSource.cxx"
+    "lib/Link.cxx"
+    "lib/LinkProcess.cxx"
+    "lib/LiteralStorage.cxx"
+    "lib/Location.cxx"
+    "lib/Lpd.cxx"
+    "lib/Markup.cxx"
+    "lib/Message.cxx"
+    "lib/MessageArg.cxx"
+    "lib/MessageEventHandler.cxx"
+    "lib/MessageFormatter.cxx"
+    "lib/MessageReporter.cxx"
+    "lib/MessageTable.cxx"
+    "lib/ModeInfo.cxx"
+    "lib/Notation.cxx"
+    "lib/NotationStorage.cxx"
+    "lib/NumericCharRefOrigin.cxx"
+    "lib/OffsetOrderedList.cxx"
+    "lib/OpenElement.cxx"
+    "lib/OutputByteStream.cxx"
+    "lib/OutputCharStream.cxx"
+    "lib/OutputState.cxx"
+    "lib/Param.cxx"
+    "lib/parseAttribute.cxx"
+    "lib/parseCommon.cxx"
+    "lib/parseDecl.cxx"
+    "lib/parseInstance.cxx"
+    "lib/parseMode.cxx"
+    "lib/parseParam.cxx"
+    "lib/Parser.cxx"
+    "lib/parser_inst.cxx"
+    "lib/ParserApp.cxx"
+    "lib/ParserEventGeneratorKit.cxx"
+    "lib/ParserMessages.cxx"
+    "lib/ParserOptions.cxx"
+    "lib/ParserState.cxx"
+    "lib/parseSd.cxx"
+    "lib/Partition.cxx"
+    "lib/PosixStorage.cxx"
+    "lib/Recognizer.cxx"
+    "lib/RewindStorageObject.cxx"
+    "lib/Sd.cxx"
+    "lib/SdText.cxx"
+    "lib/SearchResultMessageArg.cxx"
+    "lib/SGMLApplication.cxx"
+    "lib/SgmlParser.cxx"
+    "lib/ShortReferenceMap.cxx"
+    "lib/SJISCodingSystem.cxx"
+    "lib/SOEntityCatalog.cxx"
+    "lib/splib.cxx"
+    "lib/StdioStorage.cxx"
+    "lib/StorageManager.cxx"
+    "lib/SubstTable.cxx"
+    "lib/Syntax.cxx"
+    "lib/Text.cxx"
+    "lib/TokenMessageArg.cxx"
+    "lib/TranslateCodingSystem.cxx"
+    "lib/TrieBuilder.cxx"
+    "lib/TypeId.cxx"
+    "lib/Undo.cxx"
+    "lib/UnicodeCodingSystem.cxx"
+    "lib/UnivCharsetDesc.cxx"
+    "lib/URLStorage.cxx"
+    "lib/UTF8CodingSystem.cxx"
+    "lib/Win32CodingSystem.cxx"
+    "lib/WinApp.cxx"
+    "lib/WinInetStorage.cxx"
+    "lib/xentmgr_inst.cxx"
+    "lib/XMLCodingSystem.cxx"
+)
+
+set (libopensp_HEADERS
+    generic/EventGenerator.h
+    generic/ParserEventGeneratorKit.h
+    generic/SGMLApplication.h
+    include/Allocator.h
+    include/ArcEngine.h
+    include/Attribute.h
+    include/Attributed.h
+    include/Big5CodingSystem.h
+    include/Boolean.h
+    include/CharMap.h
+    include/CharsetDecl.h
+    include/CharsetInfo.h
+    include/CharsetRegistry.h
+    include/CmdLineApp.h
+    include/CodingSystem.h
+    include/CodingSystemKit.h
+    config.h
+    include/ConsoleOutput.h
+    include/constant.h
+    include/ContentState.h
+    include/ContentToken.h
+    include/CopyOwner.h
+    include/DescriptorManager.h
+    include/Dtd.h
+    include/ElementType.h
+    include/Entity.h
+    include/EntityApp.h
+    include/EntityCatalog.h
+    include/EntityDecl.h
+    include/EntityManager.h
+    include/ErrnoMessageArg.h
+    include/ErrorCountEventHandler.h
+    include/EUCJPCodingSystem.h
+    include/Event.h
+    include/EventsWanted.h
+    include/ExtendEntityManager.h
+    include/ExternalId.h
+    include/Fixed2CodingSystem.h
+    include/Fixed4CodingSystem.h
+    include/GenericEventHandler.h
+    include/Hash.h
+    include/HashTable.h
+    include/HashTableItemBase.h
+    include/IdentityCodingSystem.h
+    include/IList.h
+    include/IListBase.h
+    include/IListIter.h
+    include/IListIterBase.h
+    include/InputSource.h
+    include/InternalInputSource.h
+    include/IQueue.h
+    include/ISet.h
+    include/ISetIter.h
+    include/Link.h
+    include/LinkProcess.h
+    include/List.h
+    include/ListIter.h
+    include/LiteralStorage.h
+    include/Location.h
+    include/Lpd.h
+    include/macros.h
+    include/Markup.h
+    include/Message.h
+    include/MessageArg.h
+    include/MessageBuilder.h
+    include/MessageEventHandler.h
+    include/MessageFormatter.h
+    include/MessageModule.h
+    include/MessageReporter.h
+    include/MessageTable.h
+    include/Mode.h
+    include/Named.h
+    include/NamedResource.h
+    include/NamedResourceTable.h
+    include/NamedTable.h
+    include/NCVector.h
+    include/Notation.h
+    include/NotationStorage.h
+    include/OpenElement.h
+    include/Options.h
+    include/OutputByteStream.h
+    include/OutputCharStream.h
+    include/Owner.h
+    include/OwnerTable.h
+    include/ParserApp.h
+    include/ParserOptions.h
+    include/PointerTable.h
+    include/PosixStorage.h
+    include/Ptr.h
+    include/RangeMap.h
+    include/Resource.h
+    include/RewindStorageObject.h
+    include/rtti.h
+    include/Sd.h
+    include/SdText.h
+    include/SearchResultMessageArg.h
+    include/SgmlParser.h
+    include/ShortReferenceMap.h
+    include/SJISCodingSystem.h
+    include/SOEntityCatalog.h
+    include/sptchar.h
+    include/StdioStorage.h
+    include/StorageManager.h
+    include/StringC.h
+    include/StringOf.h
+    include/StringResource.h
+    include/SubstTable.h
+    include/Syntax.h
+    include/Text.h
+    include/TranslateCodingSystem.h
+    include/TypeId.h
+    include/types.h
+    include/UnicodeCodingSystem.h
+    include/UnivCharsetDesc.h
+    include/URLStorage.h
+    include/UTF16CodingSystem.h
+    include/UTF8CodingSystem.h
+    include/Vector.h
+    include/Win32CodingSystem.h
+    include/WinApp.h
+    include/WinInetStorage.h
+    include/XcharMap.h
+    include/XMLCodingSystem.h
+    include/xnew.h
+)
+
+add_library(opensp SHARED ${SRC_SOURCES})
+set_target_properties(opensp PROPERTIES OUTPUT_NAME "sp133")
+target_link_libraries(opensp)
+
+install(TARGETS opensp RUNTIME DESTINATION bin ARCHIVE DESTINATION lib LIBRARY DESTINATION lib)
+install(FILES ${libopensp_HEADERS} DESTINATION include/opensp)
+
diff -Nru -x '*~' OpenSP-1.5.2.orig/config.h OpenSP-1.5.2/config.h
--- OpenSP-1.5.2.orig/config.h	2005-12-23 16:16:30.000000000 +0200
+++ OpenSP-1.5.2/config.h	2014-08-24 17:26:33.724698900 +0300
@@ -26,6 +26,12 @@
 #endif
 #endif /* __GNUG__ */
 
+#ifdef __MINGW32__
+#define SP_HAVE_BOOL
+#define SP_HAVE_TYPENAME
+#define SP_DEFINE_TEMPLATES
+#endif /* __MINGW32__ */
+
 #if defined(sun) || defined(__sun)
 // struct stat has st_blksize member
 #define SP_STAT_BLKSIZE
@@ -80,6 +86,11 @@
 #define SP_HAVE_TYPENAME
 #endif
 
+#if _MSC_VER >=1800
+// Visual Studio 2013
+#define SP_ANSI_FOR_SCOPE
+#endif
+
 #define SP_HAVE_SETMODE
 #define SP_DLLEXPORT __declspec(dllexport)
 #define SP_DLLIMPORT __declspec(dllimport)
@@ -301,15 +312,8 @@
 #define PATH_SEPARATOR ':'
 #endif
 
-
-/* new stuff */
-
-#ifndef HAVE_MUTABLE
-#define mutable
-#endif
-
 // NOTE: This is processed as a Makefile, not as a header by autoconf.
-#define SP_PACKAGE "OpenSP"
-#define SP_VERSION "1.5.2"
+#define SP_PACKAGE "@PACKAGE@"
+#define SP_VERSION "@VERSION@"
 
 #endif /* not config_INCLUDED */
diff -Nru -x '*~' OpenSP-1.5.2.orig/generic/SGMLApplication.h OpenSP-1.5.2/generic/SGMLApplication.h
--- OpenSP-1.5.2.orig/generic/SGMLApplication.h	2005-05-14 12:17:41.000000000 +0300
+++ OpenSP-1.5.2/generic/SGMLApplication.h	2014-08-24 17:23:19.957120700 +0300
@@ -269,6 +269,7 @@
     unsigned count_;
     friend class OpenEntityPtr;
   };
+  SGMLApplication();
   virtual ~SGMLApplication();
   virtual void appinfo(const AppinfoEvent &);
   virtual void startDtd(const StartDtdEvent &);
diff -Nru -x '*~' OpenSP-1.5.2.orig/include/OutputCharStream.h OpenSP-1.5.2/include/OutputCharStream.h
--- OpenSP-1.5.2.orig/include/OutputCharStream.h	2005-07-21 17:04:39.000000000 +0300
+++ OpenSP-1.5.2/include/OutputCharStream.h	2014-08-24 17:23:19.957120700 +0300
@@ -31,6 +31,7 @@
   OutputCharStream &operator<<(const char *);
   OutputCharStream &operator<<(const StringC &);
   OutputCharStream &operator<<(unsigned long);
+  OutputCharStream &operator<<(unsigned long long);
   OutputCharStream &operator<<(int);
   OutputCharStream &operator<<(Newline);
 private:
diff -Nru -x '*~' OpenSP-1.5.2.orig/lib/MessageReporter.cxx OpenSP-1.5.2/lib/MessageReporter.cxx
--- OpenSP-1.5.2.orig/lib/MessageReporter.cxx	2005-07-21 17:05:17.000000000 +0300
+++ OpenSP-1.5.2/lib/MessageReporter.cxx	2014-08-24 17:23:19.957120700 +0300
@@ -123,7 +123,11 @@
     os() << ':';
   }
   if (options_ & messageNumbers)
+#ifdef _WIN64
+    os() << (unsigned long long)message.type->module() << "." 
+#else
     os() << (unsigned long)message.type->module() << "." 
+#endif
       << (unsigned long)message.type->number() << ":";
   switch (message.type->severity()) {
   case MessageType::info:
diff -Nru -x '*~' OpenSP-1.5.2.orig/lib/OutputCharStream.cxx OpenSP-1.5.2/lib/OutputCharStream.cxx
--- OpenSP-1.5.2.orig/lib/OutputCharStream.cxx	2005-07-21 17:05:17.000000000 +0300
+++ OpenSP-1.5.2/lib/OutputCharStream.cxx	2014-08-24 17:23:19.957120700 +0300
@@ -61,6 +61,13 @@
   return *this << buf;
 }
 
+OutputCharStream &OutputCharStream::operator<<(unsigned long long n)
+{
+  char buf[sizeof(unsigned long long)*3 + 1];
+  sprintf(buf, "%I64u", n);
+  return *this << buf;
+}
+
 OutputCharStream &OutputCharStream::operator<<(int n)
 {
   char buf[sizeof(int)*3 + 2];
diff -Nru -x '*~' OpenSP-1.5.2.orig/lib/SGMLApplication.cxx OpenSP-1.5.2/lib/SGMLApplication.cxx
--- OpenSP-1.5.2.orig/lib/SGMLApplication.cxx	2005-07-21 17:05:18.000000000 +0300
+++ OpenSP-1.5.2/lib/SGMLApplication.cxx	2014-08-24 17:23:19.972745700 +0300
@@ -9,6 +9,10 @@
 #include "Boolean.h"
 #include "SGMLApplication.h"
 
+SGMLApplication::SGMLApplication()
+{
+}
+
 SGMLApplication::~SGMLApplication()
 {
 }
