diff --git a/drivers/meson.build b/drivers/meson.build
index 1d8123b00c..7ccf9187b2 100644
--- a/drivers/meson.build
+++ b/drivers/meson.build
@@ -126,14 +126,15 @@ foreach subpath:subdirs
                 if not build
                     break
                 endif
-                if not is_variable('shared_rte_' + d)
+                if get_option('default_library') == 'static' and is_variable('static_rte_' + d)
+                    static_deps += [get_variable('static_rte_' + d)]
+                elif get_option('default_library') == 'shared' and is_variable('shared_rte_' + d)
+                    shared_deps += [get_variable('shared_rte_' + d)]
+                else
                     build = false
                     reason = 'missing internal dependency, "@0@"'.format(d)
                     message('Disabling @1@ [@2@]: missing internal dependency "@0@"'
                             .format(d, name, 'drivers/' + drv_path))
-                else
-                    shared_deps += [get_variable('shared_rte_' + d)]
-                    static_deps += [get_variable('static_rte_' + d)]
                 endif
             endforeach
         endif
@@ -173,6 +174,7 @@ foreach subpath:subdirs
                 output: out_filename,
                 depends: [tmp_lib])
 
+        if get_option('default_library') == 'static'
         # now build the static driver
         static_lib = static_library(lib_name,
                 sources,
@@ -182,6 +184,14 @@ foreach subpath:subdirs
                 c_args: cflags,
                 install: true)
 
+        static_dep = declare_dependency(
+                include_directories: includes,
+                dependencies: static_deps)
+        dpdk_drivers += static_lib
+        set_variable('static_@0@'.format(lib_name), static_dep)
+
+        else
+
         # now build the shared driver
         version_map = '@0@/@1@/version.map'.format(meson.current_source_dir(), drv_path)
         implib = 'lib' + lib_name + '.dll.a'
@@ -237,14 +247,10 @@ foreach subpath:subdirs
         shared_dep = declare_dependency(link_with: shared_lib,
                 include_directories: includes,
                 dependencies: shared_deps)
-        static_dep = declare_dependency(
-                include_directories: includes,
-                dependencies: static_deps)
+        set_variable('shared_@0@'.format(lib_name), shared_dep)
 
-        dpdk_drivers += static_lib
+        endif
 
-        set_variable('shared_@0@'.format(lib_name), shared_dep)
-        set_variable('static_@0@'.format(lib_name), static_dep)
         dependency_name = ''.join(lib_name.split('rte_'))
         if developer_mode
             message('drivers/@0@: Defining dependency "@1@"'.format(
diff --git a/drivers/net/octeontx/base/meson.build b/drivers/net/octeontx/base/meson.build
index 8e5e8c1b55..a793c193c3 100644
--- a/drivers/net/octeontx/base/meson.build
+++ b/drivers/net/octeontx/base/meson.build
@@ -10,7 +10,7 @@ sources = [
 depends = ['ethdev', 'mempool_octeontx']
 static_objs = []
 foreach d: depends
-    if not is_variable('shared_rte_' + d)
+    if not is_variable('static_rte_' + d)
         subdir_done()
     endif
     static_objs += get_variable('static_rte_' + d)
diff --git a/lib/meson.build b/lib/meson.build
index 24adbe44c9..f8e0788d36 100644
--- a/lib/meson.build
+++ b/lib/meson.build
@@ -146,14 +146,15 @@ foreach l:libraries
         if not build
             break
         endif
-        if not is_variable('shared_rte_' + d)
+        if get_option('default_library') == 'static'
+            static_deps += [get_variable('static_rte_' + d)]
+        elif is_variable('shared_rte_' + d)
+            shared_deps += [get_variable('shared_rte_' + d)]
+        else
             build = false
             reason = 'missing internal dependency, "@0@"'.format(d)
             message('Disabling @1@ [@2@]: missing internal dependency "@0@"'
                     .format(d, name, 'lib/' + l))
-        else
-            shared_deps += [get_variable('shared_rte_' + d)]
-            static_deps += [get_variable('static_rte_' + d)]
         endif
     endforeach
 
@@ -185,6 +186,7 @@ foreach l:libraries
     endif
     cflags += '-DRTE_LOG_DEFAULT_LOGTYPE=lib.' + l
 
+    if get_option('default_library') == 'static'
     # first build static lib
     static_lib = static_library(libname,
             sources,
@@ -201,7 +203,14 @@ foreach l:libraries
         # use pre-build objects to build shared lib
         sources = []
         objs += static_lib.extract_all_objects(recursive: false)
+    endif
+
+    dpdk_static_libraries = [static_lib] + dpdk_static_libraries
+    set_variable('static_rte_' + name, static_dep)
+
     else
+
+    if use_function_versioning and not is_windows
         # for compat we need to rebuild with
         # RTE_BUILD_SHARED_LIB defined
         cflags += '-DRTE_BUILD_SHARED_LIB'
@@ -262,10 +271,10 @@ foreach l:libraries
             dependencies: shared_deps)
 
     dpdk_libraries = [shared_lib] + dpdk_libraries
-    dpdk_static_libraries = [static_lib] + dpdk_static_libraries
-
     set_variable('shared_rte_' + name, shared_dep)
-    set_variable('static_rte_' + name, static_dep)
+
+    endif
+
     if developer_mode
         message('lib/@0@: Defining dependency "@1@"'.format(l, name))
     endif
