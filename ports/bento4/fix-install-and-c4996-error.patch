From cfb574bc4f1c8cda9fd33216cab6c53f60e1d487 Mon Sep 17 00:00:00 2001
From: Ramadan <ramadan.ahmedr93@gmail.com>
Date: Sat, 30 Nov 2019 13:31:40 +0200
Subject: [PATCH] Fix install

---
 Bento4Config.cmake |  2 ++
 CMakeLists.txt     | 32 ++++++++++++++++++++++++++++++--
 2 files changed, 32 insertions(+), 2 deletions(-)
 create mode 100644 Bento4Config.cmake

diff --git a/Bento4Config.cmake b/Bento4Config.cmake
new file mode 100644
index 0000000..dc07afc
--- /dev/null
+++ b/Bento4Config.cmake
@@ -0,0 +1,2 @@
+include(CMakeFindDependencyMacro)
+include("${CMAKE_CURRENT_LIST_DIR}/Bento4Targets.cmake")
\ No newline at end of file
diff --git a/CMakeLists.txt b/CMakeLists.txt
index 2f08b2f..f116d53 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -33,7 +33,9 @@ else()
   set(AP4_SOURCES ${AP4_SOURCES} ${SOURCE_SYSTEM}/Posix/Ap4PosixRandom.cpp)
 endif()
 
-add_library(ap4 STATIC ${AP4_SOURCES})
+add_library(Bento4 STATIC ${AP4_SOURCES})
+
+add_definitions(-D_CRT_SECURE_NO_WARNINGS)
 
 # Includes
 include_directories(
@@ -43,10 +45,36 @@ include_directories(
   ${SOURCE_METADATA}
 )
 
+# AP4 includes
+file(GLOB AP4_INCLUDES
+  ${SOURCE_CODECS}/*.h
+  ${SOURCE_CORE}/*.h
+  ${SOURCE_CRYPTO}/*.h
+  ${SOURCE_METADATA}/*.h
+)
+
 # Apps
 file(GLOB BENTO4_APPS RELATIVE ${SOURCE_ROOT}/Apps ${SOURCE_ROOT}/Apps/*)
 foreach(app ${BENTO4_APPS})
   string(TOLOWER ${app} binary_name)
   add_executable(${binary_name} ${SOURCE_ROOT}/Apps/${app}/${app}.cpp)
-  target_link_libraries(${binary_name} ap4)
+  target_link_libraries(${binary_name} Bento4)
 endforeach()
+
+install(TARGETS Bento4
+        EXPORT   Bento4Targets
+        LIBRARY  DESTINATION lib
+        ARCHIVE  DESTINATION lib
+        RUNTIME  DESTINATION bin
+        INCLUDES DESTINATION include)
+
+install(EXPORT Bento4Targets
+        FILE Bento4Targets.cmake
+        NAMESPACE Bento4::
+        DESTINATION cmake/Bento4)
+
+install(FILES ${AP4_INCLUDES} DESTINATION include)
+
+install(FILES 
+        Bento4Config.cmake 
+        DESTINATION cmake/Bento4)
-- 
2.22.0.windows.1

