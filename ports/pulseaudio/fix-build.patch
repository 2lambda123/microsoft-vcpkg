diff --git a/meson.build b/meson.build
index 6507891687..51495e67a8 100644
--- a/meson.build
+++ b/meson.build
@@ -60,7 +60,7 @@ i18n = import('i18n')
 # Paths
 
 prefix = get_option('prefix')
-assert(prefix.startswith('/'), 'Prefix is not absolute: "@0@"'.format(prefix))
+# assert(prefix.startswith('/'), 'Prefix is not absolute: "@0@"'.format(prefix))
 
 bindir = join_paths(prefix, get_option('bindir'))
 includedir = join_paths(prefix, get_option('includedir'))
@@ -205,8 +205,8 @@ elif host_machine.system() == 'windows'
   ws2_32_dep = meson.get_compiler('c').find_library('ws2_32')
   winsock_dep = meson.get_compiler('c').find_library('wsock32')
   ole32_dep = meson.get_compiler('c').find_library('ole32')
-  ssp_dep = meson.get_compiler('c').find_library('ssp')
-  pcreposix_dep = meson.get_compiler('c').find_library('pcreposix')
+  ssp_dep = [] # meson.get_compiler('c').find_library('ssp')
+  pcreposix_dep =  [] #meson.get_compiler('c').find_library('pcreposix')
   platform_socket_dep = [ws2_32_dep, winsock_dep]
   platform_dep = [ole32_dep, ssp_dep, pcreposix_dep]
 elif host_machine.system() == 'freebsd'
@@ -446,8 +446,10 @@ if get_option('gcov')
 endif
 
 # Core Dependencies
-
-libm_dep = cc.find_library('m', required : true)
+libm_dep = []
+if host_machine.system() != 'windows'
+  libm_dep = cc.find_library('m', required : true)
+endif
 
 thread_dep = dependency('threads')
 foreach f : [
diff --git a/src/daemon/caps.c b/src/daemon/caps.c
index fd135c0d23..57e7b9bf43 100644
--- a/src/daemon/caps.c
+++ b/src/daemon/caps.c
@@ -22,7 +22,9 @@
 #include <config.h>
 #endif
 
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <errno.h>
 #include <sys/types.h>
 
diff --git a/src/daemon/cpulimit.c b/src/daemon/cpulimit.c
index a3deaf2504..9237e5076d 100644
--- a/src/daemon/cpulimit.c
+++ b/src/daemon/cpulimit.c
@@ -36,7 +36,9 @@
 #include <errno.h>
 #include <stdio.h>
 #include <string.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <signal.h>
 
 #ifdef HAVE_SYS_RESOURCE_H
diff --git a/src/daemon/daemon-conf.c b/src/daemon/daemon-conf.c
index ffef554be0..5dd1b6b1e1 100644
--- a/src/daemon/daemon-conf.c
+++ b/src/daemon/daemon-conf.c
@@ -25,7 +25,9 @@
 #include <errno.h>
 #include <stdio.h>
 #include <string.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <fcntl.h>
 #include <sys/stat.h>
 
diff --git a/src/daemon/main.c b/src/daemon/main.c
index 924a4d4aa6..74e3b1ce85 100644
--- a/src/daemon/main.c
+++ b/src/daemon/main.c
@@ -22,7 +22,9 @@
 #include <config.h>
 #endif
 
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <errno.h>
 #include <string.h>
 #include <stdlib.h>
@@ -31,7 +33,9 @@
 #include <stddef.h>
 #include <ltdl.h>
 #include <limits.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <locale.h>
 #include <sys/types.h>
 #include <sys/stat.h>
diff --git a/src/modules/jack/module-jack-sink.c b/src/modules/jack/module-jack-sink.c
index 5a690cbb56..9a66e76dbc 100644
--- a/src/modules/jack/module-jack-sink.c
+++ b/src/modules/jack/module-jack-sink.c
@@ -25,7 +25,9 @@
 #include <stdio.h>
 #include <errno.h>
 #include <string.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 
 #include <jack/jack.h>
 #include <jack/metadata.h>
diff --git a/src/modules/jack/module-jack-source.c b/src/modules/jack/module-jack-source.c
index dbee5a68ee..ece699f4e2 100644
--- a/src/modules/jack/module-jack-source.c
+++ b/src/modules/jack/module-jack-source.c
@@ -25,7 +25,9 @@
 #include <stdio.h>
 #include <errno.h>
 #include <string.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 
 #include <jack/jack.h>
 #include <jack/metadata.h>
diff --git a/src/modules/macosx/module-bonjour-publish.c b/src/modules/macosx/module-bonjour-publish.c
index 8f8a53087d..f520ab46be 100644
--- a/src/modules/macosx/module-bonjour-publish.c
+++ b/src/modules/macosx/module-bonjour-publish.c
@@ -25,7 +25,9 @@
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <dns_sd.h>
 
 #include <CoreFoundation/CoreFoundation.h>
diff --git a/src/modules/module-card-restore.c b/src/modules/module-card-restore.c
index c93d584efa..c06135d264 100644
--- a/src/modules/module-card-restore.c
+++ b/src/modules/module-card-restore.c
@@ -21,7 +21,9 @@
 #include <config.h>
 #endif
 
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <string.h>
 #include <errno.h>
 #include <sys/types.h>
diff --git a/src/modules/module-cli.c b/src/modules/module-cli.c
index 547c818846..c1a07ed801 100644
--- a/src/modules/module-cli.c
+++ b/src/modules/module-cli.c
@@ -22,7 +22,9 @@
 #endif
 
 #include <stdio.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <fcntl.h>
 #include <errno.h>
 
diff --git a/src/modules/module-console-kit.c b/src/modules/module-console-kit.c
index c8fe2ed24d..a25c287c3f 100644
--- a/src/modules/module-console-kit.c
+++ b/src/modules/module-console-kit.c
@@ -22,7 +22,9 @@
 #endif
 
 #include <stdio.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <stdlib.h>
 #include <errno.h>
 #include <stdlib.h>
diff --git a/src/modules/module-detect.c b/src/modules/module-detect.c
index 072615f516..262f049baf 100644
--- a/src/modules/module-detect.c
+++ b/src/modules/module-detect.c
@@ -24,7 +24,9 @@
 #endif
 
 #include <stdio.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <string.h>
 #include <stdlib.h>
 #include <errno.h>
diff --git a/src/modules/module-devd-detect.c b/src/modules/module-devd-detect.c
index db3c6453b5..d360b03c3f 100644
--- a/src/modules/module-devd-detect.c
+++ b/src/modules/module-devd-detect.c
@@ -24,7 +24,9 @@
 #include <stdio.h>
 #include <stdint.h>
 #include <stdbool.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <string.h>
 #include <sys/socket.h>
 #include <sys/un.h>
diff --git a/src/modules/module-device-manager.c b/src/modules/module-device-manager.c
index b51b6c8a0c..4f1f863596 100644
--- a/src/modules/module-device-manager.c
+++ b/src/modules/module-device-manager.c
@@ -22,7 +22,9 @@
 #include <config.h>
 #endif
 
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <string.h>
 #include <errno.h>
 #include <sys/types.h>
diff --git a/src/modules/module-device-restore.c b/src/modules/module-device-restore.c
index 11dd1169d1..e8c31bc1d1 100644
--- a/src/modules/module-device-restore.c
+++ b/src/modules/module-device-restore.c
@@ -22,7 +22,9 @@
 #include <config.h>
 #endif
 
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <string.h>
 #include <errno.h>
 #include <sys/types.h>
diff --git a/src/modules/module-esound-compat-spawnfd.c b/src/modules/module-esound-compat-spawnfd.c
index 76cf608f86..20b88cfdc8 100644
--- a/src/modules/module-esound-compat-spawnfd.c
+++ b/src/modules/module-esound-compat-spawnfd.c
@@ -21,7 +21,9 @@
 #include <config.h>
 #endif
 
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <errno.h>
 
 #include <pulsecore/core-error.h>
diff --git a/src/modules/module-esound-compat-spawnpid.c b/src/modules/module-esound-compat-spawnpid.c
index 901405924d..b2cac56820 100644
--- a/src/modules/module-esound-compat-spawnpid.c
+++ b/src/modules/module-esound-compat-spawnpid.c
@@ -22,7 +22,9 @@
 #include <config.h>
 #endif
 
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <errno.h>
 #include <signal.h>
 
diff --git a/src/modules/module-esound-sink.c b/src/modules/module-esound-sink.c
index 539a4f3c92..bfac693cbe 100644
--- a/src/modules/module-esound-sink.c
+++ b/src/modules/module-esound-sink.c
@@ -25,7 +25,9 @@
 #include <stdio.h>
 #include <errno.h>
 #include <string.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 
 #ifdef HAVE_NETINET_IN_H
 #include <netinet/in.h>
diff --git a/src/modules/module-lirc.c b/src/modules/module-lirc.c
index 684689f6a4..20fdfdc197 100644
--- a/src/modules/module-lirc.c
+++ b/src/modules/module-lirc.c
@@ -22,7 +22,9 @@
 #endif
 
 #include <stdio.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <string.h>
 #include <stdlib.h>
 
diff --git a/src/modules/module-match.c b/src/modules/module-match.c
index 9b5e76cd7c..8f68c0c63e 100644
--- a/src/modules/module-match.c
+++ b/src/modules/module-match.c
@@ -21,7 +21,9 @@
 #include <config.h>
 #endif
 
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <string.h>
 #include <errno.h>
 #include <sys/types.h>
diff --git a/src/modules/module-mmkbd-evdev.c b/src/modules/module-mmkbd-evdev.c
index 31693bb28a..7225c63272 100644
--- a/src/modules/module-mmkbd-evdev.c
+++ b/src/modules/module-mmkbd-evdev.c
@@ -22,7 +22,9 @@
 #endif
 
 #include <stdio.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <string.h>
 #include <stdlib.h>
 #include <errno.h>
diff --git a/src/modules/module-native-protocol-fd.c b/src/modules/module-native-protocol-fd.c
index d93f328cc0..4e271757fc 100644
--- a/src/modules/module-native-protocol-fd.c
+++ b/src/modules/module-native-protocol-fd.c
@@ -22,7 +22,9 @@
 #endif
 
 #include <stdio.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 
 #include <pulsecore/module.h>
 #include <pulsecore/macro.h>
diff --git a/src/modules/module-null-sink.c b/src/modules/module-null-sink.c
index 714a81a639..0f71a3949f 100644
--- a/src/modules/module-null-sink.c
+++ b/src/modules/module-null-sink.c
@@ -24,7 +24,9 @@
 #include <stdlib.h>
 #include <stdio.h>
 #include <errno.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 
 #include <pulse/rtclock.h>
 #include <pulse/timeval.h>
diff --git a/src/modules/module-null-source.c b/src/modules/module-null-source.c
index 70f78d06c7..91c308fbdb 100644
--- a/src/modules/module-null-source.c
+++ b/src/modules/module-null-source.c
@@ -25,7 +25,9 @@
 #include <stdlib.h>
 #include <stdio.h>
 #include <errno.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 
 #include <pulse/rtclock.h>
 #include <pulse/timeval.h>
diff --git a/src/modules/module-pipe-sink.c b/src/modules/module-pipe-sink.c
index 43595420fc..6fd177af5d 100644
--- a/src/modules/module-pipe-sink.c
+++ b/src/modules/module-pipe-sink.c
@@ -26,7 +26,9 @@
 #include <stdio.h>
 #include <errno.h>
 #include <fcntl.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <sys/ioctl.h>
 
 #ifdef HAVE_SYS_FILIO_H
diff --git a/src/modules/module-pipe-source.c b/src/modules/module-pipe-source.c
index 32b35c1637..6fbbf65f8a 100644
--- a/src/modules/module-pipe-source.c
+++ b/src/modules/module-pipe-source.c
@@ -26,7 +26,9 @@
 #include <stdio.h>
 #include <errno.h>
 #include <fcntl.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <sys/ioctl.h>
 
 #ifdef HAVE_SYS_FILIO_H
diff --git a/src/modules/module-position-event-sounds.c b/src/modules/module-position-event-sounds.c
index dcdfb30024..6e1b6d0a80 100644
--- a/src/modules/module-position-event-sounds.c
+++ b/src/modules/module-position-event-sounds.c
@@ -21,7 +21,9 @@
 #include <config.h>
 #endif
 
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <errno.h>
 #include <sys/types.h>
 #include <stdio.h>
diff --git a/src/modules/module-protocol-stub.c b/src/modules/module-protocol-stub.c
index 5dd3fe0790..2d8c1aefc1 100644
--- a/src/modules/module-protocol-stub.c
+++ b/src/modules/module-protocol-stub.c
@@ -24,7 +24,9 @@
 
 #include <errno.h>
 #include <stdio.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 
 #ifdef HAVE_NETINET_IN_H
 #include <netinet/in.h>
diff --git a/src/modules/module-rygel-media-server.c b/src/modules/module-rygel-media-server.c
index 288c1e4969..5d91d21a37 100644
--- a/src/modules/module-rygel-media-server.c
+++ b/src/modules/module-rygel-media-server.c
@@ -24,7 +24,9 @@
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 
 #include <pulse/gccmacro.h>
 #include <pulse/xmalloc.h>
diff --git a/src/modules/module-sine-source.c b/src/modules/module-sine-source.c
index 803fae5e9e..36e0def6ff 100644
--- a/src/modules/module-sine-source.c
+++ b/src/modules/module-sine-source.c
@@ -24,7 +24,9 @@
 #include <stdlib.h>
 #include <stdio.h>
 #include <errno.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 
 #include <pulse/rtclock.h>
 #include <pulse/timeval.h>
diff --git a/src/modules/module-solaris.c b/src/modules/module-solaris.c
index d9f1d54ad6..b21947cfb8 100644
--- a/src/modules/module-solaris.c
+++ b/src/modules/module-solaris.c
@@ -27,7 +27,9 @@
 #include <stdio.h>
 #include <errno.h>
 #include <fcntl.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <sys/ioctl.h>
 #include <sys/types.h>
 
diff --git a/src/modules/module-stream-restore.c b/src/modules/module-stream-restore.c
index 7d1a0f80cb..24a6f0f225 100644
--- a/src/modules/module-stream-restore.c
+++ b/src/modules/module-stream-restore.c
@@ -22,7 +22,9 @@
 #include <config.h>
 #endif
 
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <string.h>
 #include <errno.h>
 #include <sys/types.h>
diff --git a/src/modules/module-systemd-login.c b/src/modules/module-systemd-login.c
index 51401575a7..675130ee0a 100644
--- a/src/modules/module-systemd-login.c
+++ b/src/modules/module-systemd-login.c
@@ -22,7 +22,9 @@
 #endif
 
 #include <stdio.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <stdlib.h>
 #include <errno.h>
 #include <stdlib.h>
diff --git a/src/modules/module-tunnel.c b/src/modules/module-tunnel.c
index ab094ba4e9..ae780e5df0 100644
--- a/src/modules/module-tunnel.c
+++ b/src/modules/module-tunnel.c
@@ -24,7 +24,9 @@
 
 #include "restart-module.h"
 
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <string.h>
 #include <errno.h>
 #include <sys/types.h>
diff --git a/src/modules/module-zeroconf-discover.c b/src/modules/module-zeroconf-discover.c
index 612e2ed499..0af7fa065e 100644
--- a/src/modules/module-zeroconf-discover.c
+++ b/src/modules/module-zeroconf-discover.c
@@ -24,7 +24,9 @@
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 
 #include <avahi-client/client.h>
 #include <avahi-client/lookup.h>
diff --git a/src/modules/module-zeroconf-publish.c b/src/modules/module-zeroconf-publish.c
index b39afafe49..a67765cf15 100644
--- a/src/modules/module-zeroconf-publish.c
+++ b/src/modules/module-zeroconf-publish.c
@@ -23,7 +23,9 @@
 
 #include <stdio.h>
 #include <stdlib.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 
 #include <avahi-client/client.h>
 #include <avahi-client/publish.h>
diff --git a/src/modules/oss/module-oss.c b/src/modules/oss/module-oss.c
index 048822c97e..f61b409390 100644
--- a/src/modules/oss/module-oss.c
+++ b/src/modules/oss/module-oss.c
@@ -46,7 +46,9 @@
 #include <stdio.h>
 #include <errno.h>
 #include <fcntl.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 
 #include <pulse/xmalloc.h>
 #include <pulse/util.h>
diff --git a/src/modules/oss/oss-util.c b/src/modules/oss/oss-util.c
index 80b6c8c632..d4c451227a 100644
--- a/src/modules/oss/oss-util.c
+++ b/src/modules/oss/oss-util.c
@@ -27,7 +27,9 @@
 #include <stdio.h>
 #include <errno.h>
 #include <string.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <sys/types.h>
 #include <fcntl.h>
 
diff --git a/src/modules/raop/module-raop-discover.c b/src/modules/raop/module-raop-discover.c
index 2bbf466579..4b83b9a9e4 100644
--- a/src/modules/raop/module-raop-discover.c
+++ b/src/modules/raop/module-raop-discover.c
@@ -25,7 +25,9 @@
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 
 #include <avahi-client/client.h>
 #include <avahi-client/lookup.h>
diff --git a/src/modules/raop/raop-client.c b/src/modules/raop/raop-client.c
index 2dc3145f2d..cc21cc9077 100644
--- a/src/modules/raop/raop-client.c
+++ b/src/modules/raop/raop-client.c
@@ -27,7 +27,9 @@
 #include <stdint.h>
 #include <string.h>
 #include <errno.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <sys/ioctl.h>
 #include <math.h>
 
diff --git a/src/modules/raop/raop-sink.c b/src/modules/raop/raop-sink.c
index 4f62b29ad2..cfa6d6e688 100644
--- a/src/modules/raop/raop-sink.c
+++ b/src/modules/raop/raop-sink.c
@@ -30,7 +30,9 @@
 #include <stdio.h>
 #include <errno.h>
 #include <string.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <sys/socket.h>
 #include <netinet/in.h>
 #include <netinet/tcp.h>
diff --git a/src/modules/reserve-monitor.c b/src/modules/reserve-monitor.c
index 9ccf3cd6b7..979540d635 100644
--- a/src/modules/reserve-monitor.c
+++ b/src/modules/reserve-monitor.c
@@ -25,7 +25,9 @@
 ***/
 
 #include <string.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <errno.h>
 #include <stdlib.h>
 #include <stdio.h>
diff --git a/src/modules/reserve.c b/src/modules/reserve.c
index 53bcf96642..1fcc7dce16 100644
--- a/src/modules/reserve.c
+++ b/src/modules/reserve.c
@@ -25,7 +25,9 @@
 ***/
 
 #include <string.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <errno.h>
 #include <stdlib.h>
 #include <stdio.h>
diff --git a/src/modules/rtp/module-rtp-recv.c b/src/modules/rtp/module-rtp-recv.c
index 9babf00cb9..aa81b20edf 100644
--- a/src/modules/rtp/module-rtp-recv.c
+++ b/src/modules/rtp/module-rtp-recv.c
@@ -27,7 +27,9 @@
 #include <netinet/in.h>
 #include <errno.h>
 #include <string.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <math.h>
 #ifdef HAVE_NETDB_H
 #include <netdb.h>
diff --git a/src/modules/rtp/module-rtp-send.c b/src/modules/rtp/module-rtp-send.c
index ce05360d5e..198da79a8c 100644
--- a/src/modules/rtp/module-rtp-send.c
+++ b/src/modules/rtp/module-rtp-send.c
@@ -25,7 +25,9 @@
 #include <sys/socket.h>
 #include <netinet/in.h>
 #include <errno.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #ifdef HAVE_NETDB_H
 #include <netdb.h>
 #endif
diff --git a/src/modules/rtp/rfc3550.txt b/src/modules/rtp/rfc3550.txt
index 165736cf64..3703aa0896 100644
--- a/src/modules/rtp/rfc3550.txt
+++ b/src/modules/rtp/rfc3550.txt
@@ -4788,8 +4788,12 @@ RFC 3550                          RTP                          July 2003
     * Generate a random 32-bit quantity.
     */
    #include <sys/types.h>   /* u_long */
-   #include <sys/time.h>    /* gettimeofday() */
-   #include <unistd.h>      /* get..() */
+   #ifndef _MSC_VER
+# include <sys/time.h>
+#endif    /* gettimeofday() */
+   #ifndef _MSC_VER
+# include <unistd.h>
+#endif      /* get..() */
    #include <stdio.h>       /* printf() */
    #include <time.h>        /* clock() */
    #include <sys/utsname.h> /* uname() */
diff --git a/src/modules/rtp/rtp-native.c b/src/modules/rtp/rtp-native.c
index d1a3911d79..6dce6f54f1 100644
--- a/src/modules/rtp/rtp-native.c
+++ b/src/modules/rtp/rtp-native.c
@@ -24,7 +24,9 @@
 #include <stdlib.h>
 #include <string.h>
 #include <errno.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <sys/ioctl.h>
 
 #ifdef HAVE_SYS_FILIO_H
diff --git a/src/modules/rtp/rtsp_client.c b/src/modules/rtp/rtsp_client.c
index 9fd386abe4..70cb51b3ae 100644
--- a/src/modules/rtp/rtsp_client.c
+++ b/src/modules/rtp/rtsp_client.c
@@ -24,7 +24,9 @@
 #include <stdlib.h>
 #include <string.h>
 #include <errno.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <sys/ioctl.h>
 #include <netinet/in.h>
 #include <pulse/rtclock.h>
diff --git a/src/modules/rtp/sap.c b/src/modules/rtp/sap.c
index 00a6480570..8d0596a8a2 100644
--- a/src/modules/rtp/sap.c
+++ b/src/modules/rtp/sap.c
@@ -27,7 +27,9 @@
 #include <netinet/in.h>
 #include <errno.h>
 #include <string.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <sys/ioctl.h>
 
 #ifdef HAVE_SYS_FILIO_H
diff --git a/src/modules/stdin-util.c b/src/modules/stdin-util.c
index 18408000ab..ea4bdb754e 100644
--- a/src/modules/stdin-util.c
+++ b/src/modules/stdin-util.c
@@ -22,7 +22,9 @@
 #endif
 
 #include <string.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <stdlib.h>
 #include <signal.h>
 
diff --git a/src/modules/x11/module-x11-cork-request.c b/src/modules/x11/module-x11-cork-request.c
index b9378f5687..66a242ca4f 100644
--- a/src/modules/x11/module-x11-cork-request.c
+++ b/src/modules/x11/module-x11-cork-request.c
@@ -23,7 +23,9 @@
 
 #include <stdio.h>
 #include <stdlib.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 
 #include <X11/Xlib.h>
 #include <X11/extensions/XTest.h>
diff --git a/src/modules/x11/module-x11-publish.c b/src/modules/x11/module-x11-publish.c
index da619f83cc..4c7e7e57c1 100644
--- a/src/modules/x11/module-x11-publish.c
+++ b/src/modules/x11/module-x11-publish.c
@@ -24,7 +24,9 @@
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 
 #include <xcb/xcb.h>
 
diff --git a/src/pulse/client-conf.c b/src/pulse/client-conf.c
index 1daaf9111d..62030ab8a5 100644
--- a/src/pulse/client-conf.c
+++ b/src/pulse/client-conf.c
@@ -23,7 +23,9 @@
 #endif
 
 #include <stdlib.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <errno.h>
 
 #include <pulse/xmalloc.h>
diff --git a/src/pulse/context.c b/src/pulse/context.c
index e535d044ff..647df41c3d 100644
--- a/src/pulse/context.c
+++ b/src/pulse/context.c
@@ -26,7 +26,9 @@
 #include <stdlib.h>
 #include <string.h>
 #include <sys/types.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <sys/stat.h>
 #include <errno.h>
 #include <signal.h>
diff --git a/src/pulse/def.h b/src/pulse/def.h
index 4097bd89ca..c14cecc576 100644
--- a/src/pulse/def.h
+++ b/src/pulse/def.h
@@ -22,7 +22,9 @@
 ***/
 
 #include <inttypes.h>
-#include <sys/time.h>
+#ifndef _MSC_VER
+# include <sys/time.h>
+#endif
 
 #include <pulse/cdecl.h>
 #include <pulse/sample.h>
diff --git a/src/pulse/fork-detect.c b/src/pulse/fork-detect.c
index 92993046dd..2cc83d765a 100644
--- a/src/pulse/fork-detect.c
+++ b/src/pulse/fork-detect.c
@@ -21,7 +21,12 @@
 #include <config.h>
 #endif
 
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#else
+# include <process.h>
+# define pid_t int
+#endif
 
 #include <pulsecore/atomic.h>
 #include <pulsecore/macro.h>
diff --git a/src/pulse/mainloop-api.h b/src/pulse/mainloop-api.h
index f04ba20995..e54f2d23d4 100644
--- a/src/pulse/mainloop-api.h
+++ b/src/pulse/mainloop-api.h
@@ -21,7 +21,9 @@
   License along with PulseAudio; if not, see <http://www.gnu.org/licenses/>.
 ***/
 
-#include <sys/time.h>
+#ifndef _MSC_VER
+# include <sys/time.h>
+#endif
 
 #include <pulse/cdecl.h>
 #include <pulse/version.h>
diff --git a/src/pulse/mainloop-signal.c b/src/pulse/mainloop-signal.c
index f196ad3815..cb29ff8ff4 100644
--- a/src/pulse/mainloop-signal.c
+++ b/src/pulse/mainloop-signal.c
@@ -27,7 +27,9 @@
 #include <errno.h>
 #include <stdlib.h>
 #include <string.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 
 #ifdef HAVE_WINDOWS_H
 #include <windows.h>
diff --git a/src/pulse/mainloop.c b/src/pulse/mainloop.c
index 90112f5896..b1aeb96ff9 100644
--- a/src/pulse/mainloop.c
+++ b/src/pulse/mainloop.c
@@ -23,7 +23,9 @@
 #endif
 
 #include <stdio.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <stdlib.h>
 #include <fcntl.h>
 #include <errno.h>
diff --git a/src/pulse/rtclock.c b/src/pulse/rtclock.c
index 56cacf7070..dbfb3904b5 100644
--- a/src/pulse/rtclock.c
+++ b/src/pulse/rtclock.c
@@ -21,7 +21,9 @@
 #include <config.h>
 #endif
 
-#include <sys/time.h>
+#ifndef _MSC_VER
+# include <sys/time.h>
+#endif
 
 #include <pulse/timeval.h>
 
diff --git a/src/pulse/sample.h b/src/pulse/sample.h
index 65c0c5d6b3..02c4240022 100644
--- a/src/pulse/sample.h
+++ b/src/pulse/sample.h
@@ -23,7 +23,9 @@
 
 #include <inttypes.h>
 #include <sys/types.h>
-#include <sys/param.h>
+#ifndef _MSC_VER
+# include <sys/param.h>
+#endif
 
 #include <pulse/gccmacro.h>
 #include <pulse/cdecl.h>
diff --git a/src/pulse/timeval.c b/src/pulse/timeval.c
index e991c33c27..2095eda81d 100644
--- a/src/pulse/timeval.c
+++ b/src/pulse/timeval.c
@@ -23,7 +23,9 @@
 #endif
 
 #include <stddef.h>
-#include <sys/time.h>
+#ifndef _MSC_VER
+# include <sys/time.h>
+#endif
 
 #ifdef HAVE_WINDOWS_H
 #include <windows.h>
diff --git a/src/pulse/util.c b/src/pulse/util.c
index c7b828cc2a..fe17a62ee1 100644
--- a/src/pulse/util.c
+++ b/src/pulse/util.c
@@ -28,7 +28,9 @@
 #include <stdlib.h>
 #include <string.h>
 #include <time.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <sys/types.h>
 
 #ifdef HAVE_PWD_H
diff --git a/src/pulse/xmalloc.c b/src/pulse/xmalloc.c
index 1a535b3bca..eb82024039 100644
--- a/src/pulse/xmalloc.c
+++ b/src/pulse/xmalloc.c
@@ -23,7 +23,9 @@
 
 #include <stdlib.h>
 #include <signal.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <string.h>
 #include <errno.h>
 
diff --git a/src/pulsecore/asyncmsgq.c b/src/pulsecore/asyncmsgq.c
index 47371ae196..ef542a8a74 100644
--- a/src/pulsecore/asyncmsgq.c
+++ b/src/pulsecore/asyncmsgq.c
@@ -21,7 +21,9 @@
 #include <config.h>
 #endif
 
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <errno.h>
 
 #include <pulse/xmalloc.h>
diff --git a/src/pulsecore/asyncq.c b/src/pulsecore/asyncq.c
index 53bfe4fada..fffc441d2c 100644
--- a/src/pulsecore/asyncq.c
+++ b/src/pulsecore/asyncq.c
@@ -21,7 +21,9 @@
 #include <config.h>
 #endif
 
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <errno.h>
 
 #include <pulse/xmalloc.h>
diff --git a/src/pulsecore/atomic.h b/src/pulsecore/atomic.h
index b5036ad26a..22de0c8648 100644
--- a/src/pulsecore/atomic.h
+++ b/src/pulsecore/atomic.h
@@ -216,7 +216,9 @@ static inline bool pa_atomic_ptr_cmpxchg(pa_atomic_ptr_t *a, void *old_p, void*
 
 #include <sys/cdefs.h>
 #include <sys/types.h>
-#include <sys/param.h>
+#ifndef _MSC_VER
+# include <sys/param.h>
+#endif
 #include <machine/atomic.h>
 
 typedef struct pa_atomic {
diff --git a/src/pulsecore/authkey.c b/src/pulsecore/authkey.c
index 71a9833a53..45c265376e 100644
--- a/src/pulsecore/authkey.c
+++ b/src/pulsecore/authkey.c
@@ -22,7 +22,9 @@
 #include <config.h>
 #endif
 
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <fcntl.h>
 #include <string.h>
 #include <errno.h>
diff --git a/src/pulsecore/cli-command.c b/src/pulsecore/cli-command.c
index 1a49677be1..26bdf7ab26 100644
--- a/src/pulsecore/cli-command.c
+++ b/src/pulsecore/cli-command.c
@@ -26,7 +26,9 @@
 #include <string.h>
 #include <stdlib.h>
 #include <errno.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <ltdl.h>
 #include <sys/stat.h>
 #include <dirent.h>
diff --git a/src/pulsecore/core-rtclock.c b/src/pulsecore/core-rtclock.c
index d0cf157315..6602de14b9 100644
--- a/src/pulsecore/core-rtclock.c
+++ b/src/pulsecore/core-rtclock.c
@@ -28,7 +28,9 @@
 
 #include <stddef.h>
 #include <time.h>
-#include <sys/time.h>
+#ifndef _MSC_VER
+# include <sys/time.h>
+#endif
 #include <errno.h>
 
 #ifdef HAVE_SYS_PRCTL_H
@@ -39,7 +41,9 @@
 #include <CoreServices/CoreServices.h>
 #include <mach/mach.h>
 #include <mach/mach_time.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #endif
 
 #ifdef HAVE_WINDOWS_H
diff --git a/src/pulsecore/core-util.c b/src/pulsecore/core-util.c
index 5d2bae92f9..26115b57c2 100644
--- a/src/pulsecore/core-util.c
+++ b/src/pulsecore/core-util.c
@@ -31,7 +31,9 @@
 #include <string.h>
 #include <stdio.h>
 #include <fcntl.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <limits.h>
 #include <ctype.h>
 #include <sys/types.h>
diff --git a/src/pulsecore/database-simple.c b/src/pulsecore/database-simple.c
index 96af8e0983..f13bb57287 100644
--- a/src/pulsecore/database-simple.c
+++ b/src/pulsecore/database-simple.c
@@ -24,7 +24,9 @@
 
 #include <errno.h>
 #include <sys/types.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <stdio.h>
 
 #include <pulse/xmalloc.h>
diff --git a/src/pulsecore/database-tdb.c b/src/pulsecore/database-tdb.c
index 6605ed8fcd..70e8425e1b 100644
--- a/src/pulsecore/database-tdb.c
+++ b/src/pulsecore/database-tdb.c
@@ -22,7 +22,9 @@
 #endif
 
 #include <fcntl.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <errno.h>
 
 /* Some versions of tdb lack inclusion of signal.h in the header files but use sigatomic_t */
diff --git a/src/pulsecore/fdsem.c b/src/pulsecore/fdsem.c
index 5fc22975ad..6ec18e857c 100644
--- a/src/pulsecore/fdsem.c
+++ b/src/pulsecore/fdsem.c
@@ -25,7 +25,9 @@
 #include <sys/syscall.h>
 #endif
 
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <errno.h>
 
 #include <pulsecore/atomic.h>
diff --git a/src/pulsecore/iochannel.c b/src/pulsecore/iochannel.c
index 002513839e..e0358f0950 100644
--- a/src/pulsecore/iochannel.c
+++ b/src/pulsecore/iochannel.c
@@ -23,7 +23,9 @@
 #endif
 
 #include <stdlib.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <errno.h>
 
 #ifdef HAVE_SYS_UN_H
diff --git a/src/pulsecore/log.c b/src/pulsecore/log.c
index 2ea88620b1..16307cbc8f 100644
--- a/src/pulsecore/log.c
+++ b/src/pulsecore/log.c
@@ -24,7 +24,9 @@
 
 #include <stdarg.h>
 #include <stdio.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <string.h>
 #include <errno.h>
 #include <fcntl.h>
diff --git a/src/pulsecore/macro.h b/src/pulsecore/macro.h
index ec8d31c24e..e89eb28258 100644
--- a/src/pulsecore/macro.h
+++ b/src/pulsecore/macro.h
@@ -21,10 +21,14 @@
 ***/
 
 #include <sys/types.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <assert.h>
 #include <limits.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
diff --git a/src/pulsecore/memblock.c b/src/pulsecore/memblock.c
index fb83dac57b..8471fc1ddb 100644
--- a/src/pulsecore/memblock.c
+++ b/src/pulsecore/memblock.c
@@ -25,7 +25,9 @@
 #include <stdio.h>
 #include <stdlib.h>
 #include <string.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <signal.h>
 #include <errno.h>
 
diff --git a/src/pulsecore/pid.c b/src/pulsecore/pid.c
index 8749b42765..4a8f54861d 100644
--- a/src/pulsecore/pid.c
+++ b/src/pulsecore/pid.c
@@ -23,7 +23,9 @@
 #endif
 
 #include <fcntl.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <errno.h>
 #include <sys/types.h>
 #include <sys/stat.h>
diff --git a/src/pulsecore/pipe.c b/src/pulsecore/pipe.c
index 9f86a48028..846fc8849e 100644
--- a/src/pulsecore/pipe.c
+++ b/src/pulsecore/pipe.c
@@ -22,7 +22,9 @@
 #endif
 
 #include <errno.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <fcntl.h>
 
 #include <sys/types.h>
diff --git a/src/pulsecore/protocol-native.c b/src/pulsecore/protocol-native.c
index 231d640aa6..6f6b68aa76 100644
--- a/src/pulsecore/protocol-native.c
+++ b/src/pulsecore/protocol-native.c
@@ -25,7 +25,9 @@
 #include <string.h>
 #include <stdio.h>
 #include <stdlib.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 
 #include <pulse/rtclock.h>
 #include <pulse/timeval.h>
diff --git a/src/pulsecore/pstream.c b/src/pulsecore/pstream.c
index ff62f464b2..00aa0a1f8f 100644
--- a/src/pulsecore/pstream.c
+++ b/src/pulsecore/pstream.c
@@ -24,7 +24,9 @@
 
 #include <stdio.h>
 #include <stdlib.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 
 #ifdef HAVE_NETINET_IN_H
 #include <netinet/in.h>
diff --git a/src/pulsecore/random.c b/src/pulsecore/random.c
index 508a6f8d2c..8c126692c3 100644
--- a/src/pulsecore/random.c
+++ b/src/pulsecore/random.c
@@ -23,7 +23,9 @@
 #endif
 
 #include <fcntl.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <errno.h>
 #include <stdlib.h>
 #include <time.h>
diff --git a/src/pulsecore/rtkit.c b/src/pulsecore/rtkit.c
index 87dd959326..afe5ec2cb5 100644
--- a/src/pulsecore/rtkit.c
+++ b/src/pulsecore/rtkit.c
@@ -40,7 +40,9 @@
 #endif
 
 #include <string.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <sys/types.h>
 #include <sys/syscall.h>
 #include <pulsecore/core-util.h>
diff --git a/src/pulsecore/rtkit.h b/src/pulsecore/rtkit.h
index 30cde72b89..ced09a805f 100644
--- a/src/pulsecore/rtkit.h
+++ b/src/pulsecore/rtkit.h
@@ -35,6 +35,11 @@
 extern "C" {
 #endif
 
+#ifdef _MSC_VER
+  #include <process.h>
+  #define pid_t int
+#endif
+
 /* This is the reference implementation for a client for
  * RealtimeKit. You don't have to use this, but if do, just copy these
  * sources into your repository */
diff --git a/src/pulsecore/semaphore-osx.c b/src/pulsecore/semaphore-osx.c
index c957f264f6..6508498335 100644
--- a/src/pulsecore/semaphore-osx.c
+++ b/src/pulsecore/semaphore-osx.c
@@ -27,7 +27,9 @@
 #include <pthread.h>
 #include <semaphore.h>
 #include <sys/types.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 
 #include <pulse/xmalloc.h>
 #include <pulsecore/macro.h>
diff --git a/src/pulsecore/shm.c b/src/pulsecore/shm.c
index 694f971b40..aa9e87862f 100644
--- a/src/pulsecore/shm.c
+++ b/src/pulsecore/shm.c
@@ -23,7 +23,9 @@
 #endif
 
 #include <stdlib.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <fcntl.h>
 #include <stdio.h>
 #include <errno.h>
diff --git a/src/pulsecore/shmasyncq.c b/src/pulsecore/shmasyncq.c
index 727cca7860..5ef221d53a 100644
--- a/src/pulsecore/shmasyncq.c
+++ b/src/pulsecore/shmasyncq.c
@@ -21,7 +21,9 @@
 #include <config.h>
 #endif
 
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <errno.h>
 
 #include <pulsecore/atomic.h>
diff --git a/src/pulsecore/socket-client.c b/src/pulsecore/socket-client.c
index c87406d150..10ac7f1277 100644
--- a/src/pulsecore/socket-client.c
+++ b/src/pulsecore/socket-client.c
@@ -24,7 +24,9 @@
 
 /* #undef HAVE_LIBASYNCNS */
 
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <stdio.h>
 #include <errno.h>
 #include <string.h>
diff --git a/src/pulsecore/socket-server.c b/src/pulsecore/socket-server.c
index b13012b6d7..4d538c3b70 100644
--- a/src/pulsecore/socket-server.c
+++ b/src/pulsecore/socket-server.c
@@ -27,7 +27,9 @@
 #include <string.h>
 #include <sys/types.h>
 #include <stdio.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <sys/stat.h>
 
 #ifdef HAVE_SYS_UN_H
diff --git a/src/pulsecore/socket-util.c b/src/pulsecore/socket-util.c
index 4ede0439eb..7b73e9db07 100644
--- a/src/pulsecore/socket-util.c
+++ b/src/pulsecore/socket-util.c
@@ -29,7 +29,9 @@
 #include <string.h>
 #include <stdio.h>
 #include <sys/types.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <sys/stat.h>
 
 #ifdef HAVE_SYS_UN_H
diff --git a/src/pulsecore/sound-file-stream.c b/src/pulsecore/sound-file-stream.c
index 255f4b61a1..ce46cf3bb4 100644
--- a/src/pulsecore/sound-file-stream.c
+++ b/src/pulsecore/sound-file-stream.c
@@ -23,7 +23,9 @@
 
 #include <stdlib.h>
 #include <stdio.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <fcntl.h>
 #include <errno.h>
 
diff --git a/src/pulsecore/sound-file.c b/src/pulsecore/sound-file.c
index f678430d16..11b909d6c7 100644
--- a/src/pulsecore/sound-file.c
+++ b/src/pulsecore/sound-file.c
@@ -21,7 +21,9 @@
 #include <config.h>
 #endif
 
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <fcntl.h>
 #include <errno.h>
 
diff --git a/src/pulsecore/start-child.c b/src/pulsecore/start-child.c
index 7f0719c1b0..962b51ce65 100644
--- a/src/pulsecore/start-child.c
+++ b/src/pulsecore/start-child.c
@@ -25,7 +25,9 @@
 #include <stdio.h>
 #include <sys/types.h>
 #include <dirent.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <fcntl.h>
 #include <signal.h>
 
diff --git a/src/pulsecore/start-child.h b/src/pulsecore/start-child.h
index 6222f4566f..47e9d31f18 100644
--- a/src/pulsecore/start-child.h
+++ b/src/pulsecore/start-child.h
@@ -21,7 +21,9 @@
 ***/
 
 #include <sys/types.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 
 int pa_start_child_for_read(const char *name, const char *argv1, pid_t *pid);
 
diff --git a/src/pulsecore/tagstruct.c b/src/pulsecore/tagstruct.c
index 6e9c7d15bb..22ad744473 100644
--- a/src/pulsecore/tagstruct.c
+++ b/src/pulsecore/tagstruct.c
@@ -23,8 +23,12 @@
 
 #include <stdlib.h>
 #include <string.h>
-#include <unistd.h>
-#include <sys/time.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
+#ifndef _MSC_VER
+# include <sys/time.h>
+#endif
 #include <stdarg.h>
 
 #ifdef HAVE_NETINET_IN_H
diff --git a/src/pulsecore/tagstruct.h b/src/pulsecore/tagstruct.h
index dcb51cbf61..118268cf12 100644
--- a/src/pulsecore/tagstruct.h
+++ b/src/pulsecore/tagstruct.h
@@ -22,7 +22,9 @@
 
 #include <inttypes.h>
 #include <sys/types.h>
-#include <sys/time.h>
+#ifndef _MSC_VER
+# include <sys/time.h>
+#endif
 
 #include <pulse/sample.h>
 #include <pulse/format.h>
diff --git a/src/pulsecore/thread-mq.c b/src/pulsecore/thread-mq.c
index ab3863b0e0..f0ca7a57b9 100644
--- a/src/pulsecore/thread-mq.c
+++ b/src/pulsecore/thread-mq.c
@@ -21,7 +21,9 @@
 #include <config.h>
 #endif
 
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <errno.h>
 
 #include <pulsecore/thread.h>
diff --git a/src/tests/alsa-time-test.c b/src/tests/alsa-time-test.c
index dff95bbf6c..10b31b3104 100644
--- a/src/tests/alsa-time-test.c
+++ b/src/tests/alsa-time-test.c
@@ -5,7 +5,9 @@
 #include <assert.h>
 #include <inttypes.h>
 #include <time.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <pthread.h>
 
 #include <alsa/asoundlib.h>
diff --git a/src/tests/asyncmsgq-test.c b/src/tests/asyncmsgq-test.c
index 219c020a53..97071a98ed 100644
--- a/src/tests/asyncmsgq-test.c
+++ b/src/tests/asyncmsgq-test.c
@@ -21,7 +21,9 @@
 
 #include <assert.h>
 #include <stdlib.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 
 #include <check.h>
 
diff --git a/src/tests/asyncq-test.c b/src/tests/asyncq-test.c
index 51a557ae03..c7492145ef 100644
--- a/src/tests/asyncq-test.c
+++ b/src/tests/asyncq-test.c
@@ -21,7 +21,9 @@
 
 #include <assert.h>
 #include <stdlib.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 
 #include <check.h>
 
diff --git a/src/tests/atomic-test.c b/src/tests/atomic-test.c
index 86b3d77a90..e3b0983cc7 100644
--- a/src/tests/atomic-test.c
+++ b/src/tests/atomic-test.c
@@ -39,7 +39,9 @@
 #include <config.h>
 #endif
 
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <check.h>
 
 #include <pulsecore/thread.h>
diff --git a/src/tests/close-test.c b/src/tests/close-test.c
index 7a6fec5730..e5b352ff61 100644
--- a/src/tests/close-test.c
+++ b/src/tests/close-test.c
@@ -2,7 +2,9 @@
 #include <config.h>
 #endif
 
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <fcntl.h>
 
 #include <pulsecore/core-util.h>
diff --git a/src/tests/connect-stress.c b/src/tests/connect-stress.c
index a243df9ea1..96fb54329e 100644
--- a/src/tests/connect-stress.c
+++ b/src/tests/connect-stress.c
@@ -22,7 +22,9 @@
 #include <signal.h>
 #include <string.h>
 #include <errno.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <assert.h>
 #include <stdio.h>
 #include <stdlib.h>
diff --git a/src/tests/extended-test.c b/src/tests/extended-test.c
index e855c7746a..24bd0e3ab8 100644
--- a/src/tests/extended-test.c
+++ b/src/tests/extended-test.c
@@ -21,7 +21,9 @@
 
 #include <signal.h>
 #include <errno.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <assert.h>
 #include <stdio.h>
 #include <stdlib.h>
diff --git a/src/tests/flist-test.c b/src/tests/flist-test.c
index 3abc1238aa..b11df93c8d 100644
--- a/src/tests/flist-test.c
+++ b/src/tests/flist-test.c
@@ -21,7 +21,9 @@
 
 #include <assert.h>
 #include <stdlib.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 
 #include <pulse/util.h>
 #include <pulse/xmalloc.h>
diff --git a/src/tests/interpol-test.c b/src/tests/interpol-test.c
index bb69e52537..8c109263f3 100644
--- a/src/tests/interpol-test.c
+++ b/src/tests/interpol-test.c
@@ -22,7 +22,9 @@
 #include <signal.h>
 #include <string.h>
 #include <errno.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <stdio.h>
 #include <stdlib.h>
 
diff --git a/src/tests/ipacl-test.c b/src/tests/ipacl-test.c
index 4ce3490c97..a9f757dd07 100644
--- a/src/tests/ipacl-test.c
+++ b/src/tests/ipacl-test.c
@@ -4,7 +4,9 @@
 
 #include <sys/types.h>
 #include <stdio.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <string.h>
 
 #include <check.h>
diff --git a/src/tests/lo-latency-test.c b/src/tests/lo-latency-test.c
index 813b337697..e618f65a34 100644
--- a/src/tests/lo-latency-test.c
+++ b/src/tests/lo-latency-test.c
@@ -27,7 +27,9 @@
 #include <fcntl.h>
 
 #include <errno.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <stdio.h>
 #include <stdlib.h>
 
diff --git a/src/tests/mainloop-test.c b/src/tests/mainloop-test.c
index 0ecfe82e20..e4f683d91e 100644
--- a/src/tests/mainloop-test.c
+++ b/src/tests/mainloop-test.c
@@ -20,8 +20,12 @@
 #endif
 
 #include <stdio.h>
-#include <unistd.h>
-#include <sys/time.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
+#ifndef _MSC_VER
+# include <sys/time.h>
+#endif
 #include <assert.h>
 #include <check.h>
 
diff --git a/src/tests/mcalign-test.c b/src/tests/mcalign-test.c
index 3127ccf309..d680ccc995 100644
--- a/src/tests/mcalign-test.c
+++ b/src/tests/mcalign-test.c
@@ -19,7 +19,9 @@
 #include <config.h>
 #endif
 
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <sys/types.h>
 #include <errno.h>
 #include <string.h>
diff --git a/src/tests/memblock-test.c b/src/tests/memblock-test.c
index d48349fd63..975f45c75d 100644
--- a/src/tests/memblock-test.c
+++ b/src/tests/memblock-test.c
@@ -20,7 +20,9 @@
 #endif
 
 #include <stdio.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 
 #include <check.h>
 
diff --git a/src/tests/mult-s16-test.c b/src/tests/mult-s16-test.c
index 91740c2fe9..00f3e525bc 100644
--- a/src/tests/mult-s16-test.c
+++ b/src/tests/mult-s16-test.c
@@ -20,7 +20,9 @@
 #endif
 
 #include <check.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <stdlib.h>
 #include <math.h>
 
diff --git a/src/tests/once-test.c b/src/tests/once-test.c
index c4d4b4be6c..4d445b2e73 100644
--- a/src/tests/once-test.c
+++ b/src/tests/once-test.c
@@ -24,7 +24,9 @@
 #ifdef HAVE_PTHREAD_SETAFFINITY_NP
 #ifdef __FreeBSD__
 #include <pthread_np.h>
-#include <sys/param.h>
+#ifndef _MSC_VER
+# include <sys/param.h>
+#endif
 #include <sys/cpuset.h>
 #endif
 #endif
diff --git a/src/tests/pacat-simple.c b/src/tests/pacat-simple.c
index 113ff95482..4547a12b42 100644
--- a/src/tests/pacat-simple.c
+++ b/src/tests/pacat-simple.c
@@ -20,7 +20,9 @@
 #endif
 
 #include <stdio.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <string.h>
 #include <errno.h>
 #include <fcntl.h>
diff --git a/src/tests/parec-simple.c b/src/tests/parec-simple.c
index 338a0e8016..9588295361 100644
--- a/src/tests/parec-simple.c
+++ b/src/tests/parec-simple.c
@@ -20,7 +20,9 @@
 #endif
 
 #include <stdio.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <string.h>
 #include <errno.h>
 
diff --git a/src/tests/queue-test.c b/src/tests/queue-test.c
index dfdac63cf3..3addc3796f 100644
--- a/src/tests/queue-test.c
+++ b/src/tests/queue-test.c
@@ -21,7 +21,9 @@
 
 #include <assert.h>
 #include <stdlib.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 
 #include <check.h>
 
diff --git a/src/tests/rtstutter.c b/src/tests/rtstutter.c
index 9d74855a36..0b1bffdf59 100644
--- a/src/tests/rtstutter.c
+++ b/src/tests/rtstutter.c
@@ -22,7 +22,9 @@
 #endif
 
 #include <stdlib.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <time.h>
 #include <inttypes.h>
 
@@ -31,7 +33,9 @@
 #ifdef HAVE_PTHREAD_SETAFFINITY_NP
 #ifdef __FreeBSD__
 #include <pthread_np.h>
-#include <sys/param.h>
+#ifndef _MSC_VER
+# include <sys/param.h>
+#endif
 #include <sys/cpuset.h>
 #endif
 #endif
diff --git a/src/tests/srbchannel-test.c b/src/tests/srbchannel-test.c
index 0e7b0ce90c..bce0dffefc 100644
--- a/src/tests/srbchannel-test.c
+++ b/src/tests/srbchannel-test.c
@@ -21,7 +21,9 @@
 #include <config.h>
 #endif
 
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <check.h>
 
 #include <pulse/mainloop.h>
diff --git a/src/tests/sync-playback.c b/src/tests/sync-playback.c
index 18afa180b2..0619c9c570 100644
--- a/src/tests/sync-playback.c
+++ b/src/tests/sync-playback.c
@@ -21,7 +21,9 @@
 
 #include <signal.h>
 #include <errno.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <assert.h>
 #include <stdio.h>
 #include <stdlib.h>
diff --git a/src/tests/thread-mainloop-test.c b/src/tests/thread-mainloop-test.c
index 5f6952cdec..34094f95d3 100644
--- a/src/tests/thread-mainloop-test.c
+++ b/src/tests/thread-mainloop-test.c
@@ -20,7 +20,9 @@
 #endif
 
 #include <stdlib.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <stdio.h>
 
 #include <check.h>
diff --git a/src/utils/pacat.c b/src/utils/pacat.c
index e656dee1bd..6be07bd497 100644
--- a/src/utils/pacat.c
+++ b/src/utils/pacat.c
@@ -25,7 +25,9 @@
 #include <signal.h>
 #include <string.h>
 #include <errno.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <assert.h>
 #include <stdio.h>
 #include <stdlib.h>
diff --git a/src/utils/pacmd.c b/src/utils/pacmd.c
index 6eae6c427d..209fb2994f 100644
--- a/src/utils/pacmd.c
+++ b/src/utils/pacmd.c
@@ -24,7 +24,9 @@
 #include <assert.h>
 #include <signal.h>
 #include <sys/socket.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <errno.h>
 #include <string.h>
 #include <sys/un.h>
diff --git a/src/utils/pactl.c b/src/utils/pactl.c
index d3736bc48a..51aa74c23f 100644
--- a/src/utils/pactl.c
+++ b/src/utils/pactl.c
@@ -24,7 +24,9 @@
 #include <signal.h>
 #include <string.h>
 #include <errno.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <assert.h>
 #include <stdio.h>
 #include <stdlib.h>
diff --git a/src/utils/padsp.c b/src/utils/padsp.c
index 9d1cb5cada..cd4efcf9f9 100644
--- a/src/utils/padsp.c
+++ b/src/utils/padsp.c
@@ -33,7 +33,9 @@
 #include <sys/soundcard.h>
 #include <sys/ioctl.h>
 #include <pthread.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <sys/socket.h>
 #include <sys/stat.h>
 #include <dlfcn.h>
diff --git a/src/utils/pasuspender.c b/src/utils/pasuspender.c
index 1f0c987fe5..53da243a7e 100644
--- a/src/utils/pasuspender.c
+++ b/src/utils/pasuspender.c
@@ -27,7 +27,9 @@
 #include <signal.h>
 #include <string.h>
 #include <errno.h>
-#include <unistd.h>
+#ifndef _MSC_VER
+# include <unistd.h>
+#endif
 #include <assert.h>
 #include <stdio.h>
 #include <stdlib.h>
