From e1bb2185d2f5e181e6da23ea392806d00ded58e6 Mon Sep 17 00:00:00 2001
From: xiaoyifang <yifang.xiao@outlook.com>
Date: Wed, 16 Feb 2022 20:58:45 +0800
Subject: [PATCH] patch windows

---
 include/ao/ao_private.h | 30 +++++++++++++++---------------
 include/ao/os_types.h   |  9 +++++++++
 src/ao_wmm.c            |  1 +
 src/audio_out.c         |  1 -
 4 files changed, 25 insertions(+), 16 deletions(-)
 create mode 100644 include/ao/os_types.h

diff --git a/include/ao/ao_private.h b/include/ao/ao_private.h
index 44fa03e..c3c50aa 100644
--- a/include/ao/ao_private.h
+++ b/include/ao/ao_private.h
@@ -138,13 +138,13 @@ struct ao_functions {
 
 void ao_read_config_files (ao_config *config);
 
-#define adebug(format, args...) {\
+#define adebug(format, ...) {\
     if(!device || device->verbose==2){                                  \
       if(strcmp(format,"\n")){                                          \
         if(device && device->funcs->driver_info()->short_name){         \
-          fprintf(stderr,"ao_%s debug: " format,device->funcs->driver_info()->short_name,## args); \
+          fprintf(stderr,"ao_%s debug: " format,device->funcs->driver_info()->short_name,__VA_ARGS__); \
         }else{                                                          \
-          fprintf(stderr,"debug: " format,## args);                     \
+          fprintf(stderr,"debug: " format,__VA_ARGS__);                 \
         }                                                               \
       }else{                                                            \
         fprintf(stderr,"\n");                                           \
@@ -152,13 +152,13 @@ void ao_read_config_files (ao_config *config);
     }                                                                   \
   }
 
-#define averbose(format, args...) {\
+#define averbose(format, ...) {\
     if(!device || device->verbose>0){                                   \
       if(strcmp(format,"\n")){                                          \
         if(device && device->funcs->driver_info()->short_name){         \
-          fprintf(stderr,"ao_%s info: " format,device->funcs->driver_info()->short_name,## args); \
+          fprintf(stderr,"ao_%s info: " format,device->funcs->driver_info()->short_name,__VA_ARGS__); \
         }else{                                                          \
-          fprintf(stderr,"info: " format,## args);                      \
+          fprintf(stderr,"info: " format,__VA_ARGS__);                  \
         }                                                               \
       }else{                                                            \
         fprintf(stderr,"\n");                                           \
@@ -166,13 +166,13 @@ void ao_read_config_files (ao_config *config);
     }                                                                   \
   }
 
-#define ainfo(format, args...) {\
+#define ainfo(format, ...) {\
     if(!device || device->verbose>=0){                                  \
       if(strcmp(format,"\n")){                                          \
         if(device && device->funcs->driver_info()->short_name){         \
-          fprintf(stderr,"ao_%s info: " format,device->funcs->driver_info()->short_name,## args); \
+          fprintf(stderr,"ao_%s info: " format,device->funcs->driver_info()->short_name,__VA_ARGS__); \
         }else{                                                          \
-          fprintf(stderr,"info: " format,## args);                      \
+          fprintf(stderr,"info: " format,__VA_ARGS__);                  \
         }                                                               \
       }else{                                                            \
         fprintf(stderr,"\n");                                           \
@@ -180,13 +180,13 @@ void ao_read_config_files (ao_config *config);
     }                                                                   \
   }
 
-#define awarn(format, args...) {\
+#define awarn(format, ...) {\
     if(!device || device->verbose>=0){                                  \
       if(strcmp(format,"\n")){                                          \
         if(device && device->funcs->driver_info()->short_name){         \
-          fprintf(stderr,"ao_%s WARNING: " format,device->funcs->driver_info()->short_name,## args); \
+          fprintf(stderr,"ao_%s WARNING: " format,device->funcs->driver_info()->short_name,__VA_ARGS__); \
         }else{                                                          \
-          fprintf(stderr,"WARNING: " format,## args);                   \
+          fprintf(stderr,"WARNING: " format,__VA_ARGS__);               \
         }                                                               \
       }else{                                                            \
         fprintf(stderr,"\n");                                           \
@@ -194,13 +194,13 @@ void ao_read_config_files (ao_config *config);
     }                                                                   \
   }
 
-#define aerror(format, args...) {                                       \
+#define aerror(format, ...) {                                           \
     if(!device || device->verbose>=0){                                  \
       if(strcmp(format,"\n")){                                          \
         if(device && device->funcs->driver_info()->short_name){         \
-          fprintf(stderr,"ao_%s ERROR: " format,device->funcs->driver_info()->short_name,## args); \
+          fprintf(stderr,"ao_%s ERROR: " format,device->funcs->driver_info()->short_name,__VA_ARGS__); \
         }else{                                                          \
-          fprintf(stderr,"ERROR: " format,## args);                     \
+          fprintf(stderr,"ERROR: " format,__VA_ARGS__);                 \
         }                                                               \
       }else{                                                            \
         fprintf(stderr,"\n");                                           \
diff --git a/include/ao/os_types.h b/include/ao/os_types.h
new file mode 100644
index 0000000..c0c2ea1
--- /dev/null
+++ b/include/ao/os_types.h
@@ -0,0 +1,9 @@
+#pragma once
+#include <stdint.h>
+
+typedef uint8_t  uint_8;
+typedef uint16_t uint_16;
+typedef uint32_t uint_32;
+typedef int8_t   sint_8;
+typedef int16_t  sint_16;
+typedef int32_t  sint_32;
diff --git a/src/ao_wmm.c b/src/ao_wmm.c
index eec6b83..d18d2a4 100644
--- a/src/ao_wmm.c
+++ b/src/ao_wmm.c
@@ -33,6 +33,7 @@
 #include <windows.h>
 #include <mmreg.h>
 #include <mmsystem.h>
+#include <ks.h>
 #include <ksmedia.h>
 
 #include <stdlib.h>
diff --git a/src/audio_out.c b/src/audio_out.c
index bd8f6fc..e3af366 100644
--- a/src/audio_out.c
+++ b/src/audio_out.c
@@ -49,7 +49,6 @@ static int dlclose(void *handle) { return 0; }
 #ifndef _MSC_VER
 # include <unistd.h>
 #endif
-#include <dirent.h>
 
 #include "ao/ao.h"
 #include "ao_private.h"
-- 
2.30.0.windows.2

