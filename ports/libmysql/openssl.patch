diff --git a/mysys/my_md5.cc b/mysys/my_md5.cc
index ee6ea390..9072c2c2 100644
--- a/mysys/my_md5.cc
+++ b/mysys/my_md5.cc
@@ -73,9 +73,11 @@ int compute_md5_hash(char *digest, const char *buf, int len) {
 #if OPENSSL_VERSION_NUMBER >= 0x30000000L
   int fips_mode = EVP_default_properties_is_fips_enabled(nullptr) &&
                   OSSL_PROVIDER_available(nullptr, "fips");
-#else  /* OPENSSL_VERSION_NUMBER >= 0x30000000L */
+#elif OPENSSL_VERSION_NUMBER < 0x30000000L
   int fips_mode = FIPS_mode();
-#endif /* OPENSSL_VERSION_NUMBER >= 0x30000000L */
+#else
+  int fips_mode = EVP_default_properties_is_fips_enabled(NULL);
+#endif
 
   /* If fips mode is ON/STRICT restricted method calls will result into abort,
    * skipping call. */
diff --git a/plugin/x/client/xconnection_impl.cc b/plugin/x/client/xconnection_impl.cc
index aa775129..8c234a4f 100644
--- a/plugin/x/client/xconnection_impl.cc
+++ b/plugin/x/client/xconnection_impl.cc
@@ -61,6 +61,10 @@
 #include <poll.h>
 #endif
 
+#if OPENSSL_VERSION_NUMBER >= 0x30000000L
+#include <openssl/evp.h>
+#endif
+
 #ifdef WIN32
 #define SHUT_RD SD_RECEIVE
 #define SHUT_WR SD_SEND
