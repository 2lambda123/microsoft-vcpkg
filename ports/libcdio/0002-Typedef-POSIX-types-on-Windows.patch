From ddc73066aaebd51558ec465fdd32f4c010b913f5 Mon Sep 17 00:00:00 2001
From: Sandy Carter <bwrsandman@gmail.com>
Date: Wed, 20 Dec 2023 17:40:35 -0500
Subject: [PATCH] Typedef POSIX types on Windows

---
 include/cdio/types.h       | 10 +++++++++-
 lib/driver/_cdio_generic.c | 10 ++++++++++
 src/util.h                 | 10 ++++++++++
 3 files changed, 29 insertions(+), 1 deletion(-)

diff --git a/include/cdio/types.h b/include/cdio/types.h
index fd735786..34687edb 100644
--- a/include/cdio/types.h
+++ b/include/cdio/types.h
@@ -55,7 +55,15 @@ typedef uint8_t ubyte;
    unistd.h that defines them. Such a file is provided with
    the libcdio source, in the MSVC/missing directory */
 #if defined(_MSC_VER)
-#include <unistd.h>
+#include <BaseTsd.h>
+typedef int mode_t;
+typedef SSIZE_T ssize_t;
+#ifdef _WIN64
+typedef LONGLONG off_t;
+#else
+typedef LONG off_t;
+#endif
+typedef LONGLONG off64_t;
 #endif
 
   /* default HP/UX macros are broken */
diff --git a/lib/driver/_cdio_generic.c b/lib/driver/_cdio_generic.c
index 4a7fcadf..bc8232b2 100644
--- a/lib/driver/_cdio_generic.c
+++ b/lib/driver/_cdio_generic.c
@@ -31,6 +31,16 @@
 
 #ifdef HAVE_UNISTD_H
 #include <unistd.h>
+#elif defined(_MSC_VER)
+#include <BaseTsd.h>
+typedef int mode_t;
+typedef SSIZE_T ssize_t;
+#ifdef _WIN64
+typedef LONGLONG off_t;
+#else
+typedef LONG off_t;
+#endif
+typedef LONGLONG off64_t;
 #endif
 
 #include <fcntl.h>
diff --git a/src/util.h b/src/util.h
index c554c3b7..208fa0cc 100644
--- a/src/util.h
+++ b/src/util.h
@@ -54,6 +54,16 @@
    getopt.h */
 #ifdef HAVE_UNISTD_H
 #include <unistd.h>
+#elif defined(_MSC_VER)
+#include <BaseTsd.h>
+typedef int mode_t;
+typedef SSIZE_T ssize_t;
+#ifdef _WIN64
+typedef LONGLONG off_t;
+#else
+typedef LONG off_t;
+#endif
+typedef LONGLONG off64_t;
 #endif
 #ifdef HAVE_GETOPT_H
 #include <getopt.h>
-- 
2.39.3 (Apple Git-145)

