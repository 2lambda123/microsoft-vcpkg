vcpkg_from_github(
    OUT_SOURCE_PATH SOURCE_PATH
    REPO zyantific/zydis
    REF ce4a42ffaffe4a5ff615665e05177c4c69eb4683
    SHA512 dc7fab406219e88d981101f4d87e854069ca250996ace7f5284206e03154c969eb398db02ef13a0d2b504aadc34837aebf4afbc0f9163e5771c93380a813aa36
    HEAD_REF master
)

vcpkg_from_github(
    OUT_SOURCE_PATH ZYCORE_SOURCE_PATH
    REPO zyantific/zycore-c
    REF ffcc3663200984e6cb54c2879f7b4de3f6112227
    SHA512 dba3ad674225ab72bc16a6493f245cf6f72d2a06ebfd7781533088c5697511395c085e4e99ea95e46b828466dd0246452ef0d2086c6493dcd940478adeaed17c
    HEAD_REF master
)

file(RENAME ${ZYCORE_SOURCE_PATH} ${SOURCE_PATH}/dependencies/zycore)

if(VCPKG_LIBRARY_LINKAGE STREQUAL static)
    set(ZYDIS_BUILD_SHARED_LIB OFF)
else()
    set(ZYDIS_BUILD_SHARED_LIB ON)
endif()

vcpkg_configure_cmake(
    SOURCE_PATH ${SOURCE_PATH}
    PREFER_NINJA
    OPTIONS "-DZYDIS_BUILD_SHARED_LIB=${ZYDIS_BUILD_SHARED_LIB}"
)

vcpkg_install_cmake()

file(REMOVE_RECURSE ${CURRENT_PACKAGES_DIR}/debug/include)
file(GLOB EXES ${CURRENT_PACKAGES_DIR}/bin/*.exe ${CURRENT_PACKAGES_DIR}/debug/bin/*.exe)
if(EXES)
    file(REMOVE ${EXES})
endif()

if(VCPKG_LIBRARY_LINKAGE STREQUAL static)
    file(REMOVE_RECURSE ${CURRENT_PACKAGES_DIR}/bin ${CURRENT_PACKAGES_DIR}/debug/bin)
endif()

vcpkg_copy_pdbs()

file(INSTALL ${SOURCE_PATH}/LICENSE DESTINATION ${CURRENT_PACKAGES_DIR}/share/${PORT} RENAME copyright)
