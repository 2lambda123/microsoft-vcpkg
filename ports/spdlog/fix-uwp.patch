diff --git a/include/spdlog/details/os-inl.h b/include/spdlog/details/os-inl.h
index 8473eb09..6a4fd94b 100644
--- a/include/spdlog/details/os-inl.h
+++ b/include/spdlog/details/os-inl.h
@@ -130,9 +130,11 @@ SPDLOG_INLINE std::tm gmtime() SPDLOG_NOEXCEPT
 SPDLOG_INLINE void prevent_child_fd(FILE *f)
 {
 #ifdef _WIN32
+#if WINAPI_FAMILY_PARTITION(WINAPI_PARTITION_DESKTOP | WINAPI_PARTITION_SYSTEM)
     auto file_handle = reinterpret_cast<HANDLE>(_get_osfhandle(::_fileno(f)));
     if (!::SetHandleInformation(file_handle, HANDLE_FLAG_INHERIT, 0))
         SPDLOG_THROW(spdlog_ex("SetHandleInformation failed", errno));
+#endif
 #else
     auto fd = ::fileno(f);
     if (::fcntl(fd, F_SETFD, FD_CLOEXEC) == -1)

