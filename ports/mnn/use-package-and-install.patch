diff --git a/CMakeLists.txt b/CMakeLists.txt
index 993f15d..5da4830 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -270,18 +270,28 @@ if(${CMAKE_SYSTEM_NAME} MATCHES "^Linux")
         include_directories(${aarch64_linux_include})
     endif()
 endif()
+
+if(MNN_OPENCL)
+  find_package(OpenCL REQUIRED)
+endif()
+find_package(RapidJSON CONFIG REQUIRED)
+find_path(STB_INCLUDE_DIRS "stb.h")
+find_package(Flatbuffers CONFIG REQUIRED)
 include_directories(${CMAKE_CURRENT_LIST_DIR}/include/
                     ${CMAKE_CURRENT_LIST_DIR}/source/
                     ${CMAKE_CURRENT_LIST_DIR}/express/
                     ${CMAKE_CURRENT_LIST_DIR}/tools/
                     ${CMAKE_CURRENT_LIST_DIR}/schema/current/
-                    ${CMAKE_CURRENT_LIST_DIR}/3rd_party/
-                    ${CMAKE_CURRENT_LIST_DIR}/3rd_party/flatbuffers/include
+                    # ${CMAKE_CURRENT_LIST_DIR}/3rd_party/
+                    # ${CMAKE_CURRENT_LIST_DIR}/3rd_party/flatbuffers/include
+                    # ${CMAKE_CURRENT_LIST_DIR}/3rd_party/imageHelper
+                    # ${CMAKE_CURRENT_LIST_DIR}/3rd_party/OpenCLHeaders/
                     ${CMAKE_CURRENT_LIST_DIR}/3rd_party/half
-                    ${CMAKE_CURRENT_LIST_DIR}/3rd_party/imageHelper
-                    ${CMAKE_CURRENT_LIST_DIR}/3rd_party/OpenCLHeaders/
+                    ${RAPIDJSON_INCLUDE_DIRS}
+                    ${STB_INCLUDE_DIRS}
+                    ${OpenCL_INCLUDE_DIRS}
                   )
-
+link_libraries(flatbuffers::flatbuffers ${OpenCL_LIBRARIES})
 
 set(MNN_OBJECTS_TO_LINK "")
 set(MNN_TARGETS "")
@@ -631,10 +641,14 @@ ELSEIF(NOT APPLE)
   INSTALL(FILES ${MNN_PUB_HDRS} DESTINATION include/MNN/)
   INSTALL(FILES ${MNN_EXPR_PUB_HDRS} DESTINATION include/MNN/expr/)
   install(TARGETS MNN
+      RUNTIME DESTINATION bin
       LIBRARY DESTINATION lib
       ARCHIVE DESTINATION lib
   )
+  
 ELSE()
+  INSTALL(FILES ${MNN_PUB_HDRS} DESTINATION include/MNN/)
+  INSTALL(FILES ${MNN_EXPR_PUB_HDRS} DESTINATION include/MNN/expr/)
   install(TARGETS MNN
       LIBRARY DESTINATION lib
       ARCHIVE DESTINATION lib
@@ -648,5 +662,16 @@ ELSE()
   ENDFOREACH()
   IF(MNN_METAL)
     SET_SOURCE_FILES_PROPERTIES(${CMAKE_CURRENT_BINARY_DIR}/mnn.metallib PROPERTIES MACOSX_PACKAGE_LOCATION Resources/)
+    INSTALL(FILES ${CMAKE_CURRENT_BINARY_DIR}/mnn.metallib DESTINATION bin)
   ENDIF()
 ENDIF()
+
+include(CMakePackageConfigHelpers)
+set(VERSION_FILE_PATH   ${CMAKE_BINARY_DIR}/cmake/${PROJECT_NAME}ConfigVersion.cmake)
+write_basic_package_version_file(${VERSION_FILE_PATH}
+    VERSION             ${PROJECT_VERSION}
+    COMPATIBILITY       SameMajorVersion
+)
+install(FILES           ${VERSION_FILE_PATH} 
+        DESTINATION     share/mnn
+)
diff --git a/include/MNN/Matrix.h b/include/MNN/Matrix.h
index 0d59f66..e728c46 100644
--- a/include/MNN/Matrix.h
+++ b/include/MNN/Matrix.h
@@ -1565,10 +1565,7 @@ private:
 
     typedef void (*MapXYProc)(const Matrix& mat, float x, float y, Point* result);
 
-    static MapXYProc GetMapXYProc(TypeMask mask) {
-        MNN_ASSERT((mask & ~kAllMasks) == 0);
-        return gMapXYProcs[mask & kAllMasks];
-    }
+    static MapXYProc GetMapXYProc(TypeMask mask);
 
     MapXYProc getMapXYProc() const {
         return GetMapXYProc(this->getType());
@@ -1576,10 +1573,7 @@ private:
 
     typedef void (*MapPtsProc)(const Matrix& mat, Point dst[], const Point src[], int count);
 
-    static MapPtsProc GetMapPtsProc(TypeMask mask) {
-        MNN_ASSERT((mask & ~kAllMasks) == 0);
-        return gMapPtsProcs[mask & kAllMasks];
-    }
+    static MapPtsProc GetMapPtsProc(TypeMask mask);
 
     MapPtsProc getMapPtsProc() const {
         return GetMapPtsProc(this->getType());
@@ -1600,7 +1594,7 @@ private:
     static void Identity_pts(const Matrix&, Point[], const Point[], int);
     static void Trans_pts(const Matrix&, Point dst[], const Point[], int);
     static void Scale_pts(const Matrix&, Point dst[], const Point[], int);
-    static void ScaleTrans_pts(const Matrix&, Point dst[], const Point[], int count);
+    // static void ScaleTrans_pts(const Matrix&, Point dst[], const Point[], int count);
     static void Persp_pts(const Matrix&, Point dst[], const Point[], int);
 
     static void Affine_vpts(const Matrix&, Point dst[], const Point[], int);
diff --git a/source/backend/cuda/CMakeLists.txt b/source/backend/cuda/CMakeLists.txt
index f9a24cc..583424d 100644
--- a/source/backend/cuda/CMakeLists.txt
+++ b/source/backend/cuda/CMakeLists.txt
@@ -16,9 +16,28 @@ endif()
 file(GLOB_RECURSE MNN_CUDA_SRC ${CMAKE_CURRENT_LIST_DIR}/core/* ${CMAKE_CURRENT_SOURCE_DIR}/execution/*)
 message(STATUS "message ${CUDA_NVCC_FLAGS} !!!!!!!!!!!")
 
+find_library(CUDNN_LIB NAMES cudnn PATHS ${_VCPKG_INSTALLED_DIR}/${VCPKG_TARGET_TRIPLET}/lib)
+if(NOT CUDNN_LIB)
+    message(FATAL_ERROR "cudnn not found")
+else()
+    message(STATUS "using cudnn: ${CUDNN_LIB}")
+endif()
+if(WIN32)
+    find_library(CUBLAS_LIB NAMES cublas PATHS $ENV{CUDA_PATH}/lib/x64)
+else()
+    find_library(CUBLAS_LIB cublas)
+endif()
+if(NOT CUBLAS_LIB)
+    message(FATAL_ERROR "cublas not found")
+else()
+    message(STATUS "using cublas: ${CUBLAS_LIB}")
+endif()
+
 # add_library(MNN_Cuda SHARED ${MNN_CUDA_SRC} )
-cuda_add_library(MNN_Cuda_Main SHARED ${MNN_CUDA_SRC} )
-set(MNN_CUDA_LIBS MNN_Cuda_Main cudnn cublas PARENT_SCOPE)
+cuda_add_library(MNN_Cuda_Main STATIC ${MNN_CUDA_SRC} )
+target_link_libraries(MNN_Cuda_Main ${CUDNN_LIB} ${CUBLAS_LIB})
+
+set(MNN_CUDA_LIBS MNN_Cuda_Main ${CUDNN_LIB} PARENT_SCOPE)
 add_library(MNN_CUDA OBJECT Register.cpp)
 
 include_directories(
diff --git a/source/backend/tensorrt/CMakeLists.txt b/source/backend/tensorrt/CMakeLists.txt
index aadabd6..ce8c0f0 100644
--- a/source/backend/tensorrt/CMakeLists.txt
+++ b/source/backend/tensorrt/CMakeLists.txt
@@ -7,7 +7,7 @@ FIND_PACKAGE(CUDA REQUIRED)
 
 add_library( MNN_TRT OBJECT ${MNN_TRT_SRCS})
 
-include_directories(/usr/local/cuda/include/)
+include_directories(${CUDA_INCLUDE_DIRS})
 include_directories(${CMAKE_CURRENT_LIST_DIR}/backend/)
 include_directories(${CMAKE_CURRENT_LIST_DIR}/execution/)
 include_directories(${CMAKE_CURRENT_LIST_DIR}/execution/plugin/)
diff --git a/source/cv/Matrix_CV.cpp b/source/cv/Matrix_CV.cpp
index 62e0b61..ee3fe57 100644
--- a/source/cv/Matrix_CV.cpp
+++ b/source/cv/Matrix_CV.cpp
@@ -829,6 +829,11 @@ const Matrix::MapPtsProc Matrix::gMapPtsProcs[] = {
     Matrix::Persp_pts, Matrix::Persp_pts, Matrix::Persp_pts, Matrix::Persp_pts, Matrix::Persp_pts, Matrix::Persp_pts,
     Matrix::Persp_pts, Matrix::Persp_pts};
 
+Matrix::MapPtsProc Matrix::GetMapPtsProc(TypeMask mask) {
+    MNN_ASSERT((mask & ~kAllMasks) == 0);
+    return gMapPtsProcs[mask & kAllMasks];
+}
+
 static Sk4f sort_as_rect(const Sk4f& ltrb) {
     Sk4f rblt(ltrb[2], ltrb[3], ltrb[0], ltrb[1]);
     Sk4f min = Sk4f::Min(ltrb, rblt);
@@ -940,6 +945,10 @@ const Matrix::MapXYProc Matrix::gMapXYProcs[] = {
     // repeat the persp proc 8 times
     Matrix::Persp_xy, Matrix::Persp_xy, Matrix::Persp_xy, Matrix::Persp_xy, Matrix::Persp_xy, Matrix::Persp_xy,
     Matrix::Persp_xy, Matrix::Persp_xy};
+Matrix::MapXYProc Matrix::GetMapXYProc(TypeMask mask) {
+    MNN_ASSERT((mask & ~kAllMasks) == 0);
+    return gMapXYProcs[mask & kAllMasks];
+}
 
 uint8_t Matrix::computeTypeMask() const {
     unsigned mask = 0;
diff --git a/tools/converter/CMakeLists.txt b/tools/converter/CMakeLists.txt
index 2d5133a..bc00026 100644
--- a/tools/converter/CMakeLists.txt
+++ b/tools/converter/CMakeLists.txt
@@ -38,11 +38,12 @@ IF(MNN_BUILD_CONVERTER)
     ${CMAKE_CURRENT_LIST_DIR}/source/cli.cpp
     ${CMAKE_CURRENT_LIST_DIR}/source/config.cpp
   )
-  IF(MNN_BUILD_SHARED_LIBS)
-    add_library(MNNConvertDeps SHARED ${COMMON_SRC} ${MNN_CONVERTER_BACKENDS_OBJECTS} ${CMAKE_CURRENT_LIST_DIR}/../../3rd_party/flatbuffers/src/util.cpp $<TARGET_OBJECTS:MNNUtils>)
+  # if Windows, meld MNNConvertDeps(lib) into MNNConvert(exe)
+  IF(MNN_BUILD_SHARED_LIBS AND NOT WIN32)
+    add_library(MNNConvertDeps SHARED ${COMMON_SRC} ${MNN_CONVERTER_BACKENDS_OBJECTS} $<TARGET_OBJECTS:MNNUtils>)
     add_dependencies(MNNConvertDeps MNN)
   ELSE()
-    add_library(MNNConvertDeps STATIC ${COMMON_SRC} ${MNN_CONVERTER_BACKENDS_OBJECTS} ${CMAKE_CURRENT_LIST_DIR}/../../3rd_party/flatbuffers/src/util.cpp)
+    add_library(MNNConvertDeps STATIC ${COMMON_SRC} ${MNN_CONVERTER_BACKENDS_OBJECTS})
   ENDIF()
   
   
@@ -68,5 +69,7 @@ IF(MNN_BUILD_CONVERTER)
     add_executable(TestConvertResult ${CMAKE_CURRENT_LIST_DIR}/source/TestConvertResult.cpp)
     target_link_libraries(TestConvertResult MNNConvertDeps)
     target_link_libraries(MNNConvert MNNConvertDeps)
+    install(TARGETS TestConvertResult RUNTIME DESTINATION bin)
   ENDIF()
+  install(TARGETS MNNDump2Json MNNConvert RUNTIME DESTINATION bin)
 ENDIF()
diff --git a/tools/cpp/CMakeLists.txt b/tools/cpp/CMakeLists.txt
index def574c..eb83133 100644
--- a/tools/cpp/CMakeLists.txt
+++ b/tools/cpp/CMakeLists.txt
@@ -53,3 +53,5 @@ if (MSVC)
         endif()
     endforeach()
 endif()
+
+install(TARGETS ${MNN_CPP_TOOLS} RUNTIME DESTINATION bin)
diff --git a/tools/evaluation/CMakeLists.txt b/tools/evaluation/CMakeLists.txt
index 8773372..3615b5c 100644
--- a/tools/evaluation/CMakeLists.txt
+++ b/tools/evaluation/CMakeLists.txt
@@ -7,4 +7,5 @@ IF(MNN_EVALUATION)
         target_link_options(classficationTopkEval.out PRIVATE /WHOLEARCHIVE:$<TARGET_FILE:${DEPEND}>)
       endforeach ()
   endif()
+  install(TARGETS classficationTopkEval.out RUNTIME DESTINATION bin)
 ENDIF()
\ No newline at end of file
diff --git a/tools/quantization/CMakeLists.txt b/tools/quantization/CMakeLists.txt
index 1e84ee0..00aecd7 100644
--- a/tools/quantization/CMakeLists.txt
+++ b/tools/quantization/CMakeLists.txt
@@ -1,3 +1,5 @@
 file(GLOB QUANFILES ${CMAKE_CURRENT_LIST_DIR}/*.cpp)
 add_executable(quantized.out ${QUANFILES})
 target_link_libraries(quantized.out ${MNN_DEPS})
+
+install(TARGETS quantized.out RUNTIME DESTINATION bin)
diff --git a/tools/train/CMakeLists.txt b/tools/train/CMakeLists.txt
index 48f355b..0bbb8ef 100644
--- a/tools/train/CMakeLists.txt
+++ b/tools/train/CMakeLists.txt
@@ -27,6 +27,10 @@ if (MNN_BUILD_TRAIN_MINI)
 else()
     add_library(MNNTrain ${MNN_LIBARY_TYPE} ${GRAD} ${BASIC_INCLUDE} ${OPTIMIZER} ${DATALOADER} ${TRANSFORMER} ${MODELS} ${DATASETS})
 endif()
+IF(MNN_BUILD_SHARED_LIBS)
+    target_compile_definitions(MNNTrain PRIVATE BUILDING_MNN_DLL)
+ENDIF()
+
 target_link_libraries(MNNTrain ${MNN_DEPS})
 
 add_executable(transformer.out ${CMAKE_CURRENT_LIST_DIR}/source/exec/transformerExecution.cpp)
@@ -38,7 +42,7 @@ target_link_libraries(train.out MNN)
 
 add_executable(rawDataTransform.out ${CMAKE_CURRENT_LIST_DIR}/source/exec/rawDataTransform.cpp ${SCHEMA} ${BASIC_INCLUDE})
 
-include_directories(../../3rd_party/imageHelper/)
+# include_directories(../../3rd_party/imageHelper/)
 add_executable(dataTransformer.out ${CMAKE_CURRENT_LIST_DIR}/source/exec/dataTransformer.cpp ${SCHEMA} ${BASIC_INCLUDE})
 target_link_libraries(dataTransformer.out MNN)
 
@@ -59,3 +63,9 @@ if (MNN_USE_OPENCV)
     add_definitions(-D MNN_USE_OPENCV)
     target_link_libraries(runTrainDemo.out ${OpenCV_LIBS})
 endif()
+
+install(TARGETS MNNTrain transformer.out train.out dataTransformer.out runTrainDemo.out
+    RUNTIME DESTINATION bin
+    LIBRARY DESTINATION lib
+    ARCHIVE DESTINATION lib
+)
