diff --git a/CMakeLists.txt b/CMakeLists.txt
index dac5992..701ecc3 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -742,7 +742,7 @@ IF(USE_HDF5)
       SET(SEARCH_PACKAGE_NAME ${HDF5_PACKAGE_NAME})
       FIND_PACKAGE(HDF5 NAMES ${SEARCH_PACKAGE_NAME} COMPONENTS C HL CONFIG REQUIRED ${NC_HDF5_LINK_TYPE})
     ELSE(MSVC)
-      FIND_PACKAGE(HDF5 COMPONENTS C HL REQUIRED)
+      FIND_PACKAGE(HDF5 COMPONENTS C HL CONFIG REQUIRED)
     ENDIF(MSVC)
 
     ##
@@ -857,6 +857,19 @@ IF(USE_HDF5)
 
   ENDIF(HDF5_C_LIBRARY AND HDF5_HL_LIBRARY AND HDF5_INCLUDE_DIR)
 
+  if(TARGET hdf5::hdf5-shared)
+    set(HDF5_C_LIBRARY hdf5::hdf5-shared)
+    set(HDF5_C_LIBRARY_hdf5 hdf5::hdf5-shared)
+    set(HDF5_HL_LIBRARIES hdf5::hdf5_hl-shared)
+    ADD_DEFINITIONS(-DH5_BUILT_AS_DYNAMIC_LIB)
+  else()
+    set(HDF5_C_LIBRARY hdf5::hdf5-static)
+    set(HDF5_C_LIBRARY_hdf5 hdf5::hdf5-static)
+    set(HDF5_HL_LIBRARIES hdf5::hdf5_hl-static)
+    ADD_DEFINITIONS(-DH5_BUILT_AS_STATIC_LIB)
+  endif()
+  list(APPEND CMAKE_REQUIRED_LIBRARIES ${HDF5_C_LIBRARY})
+
   FIND_PACKAGE(Threads)
 
   # There is a missing case in the above code so default it
@@ -984,8 +997,7 @@ IF(USE_HDF5)
 ENDIF(USE_HDF5)
 
 # See if we have libcurl
-FIND_PACKAGE(CURL)
-ADD_DEFINITIONS(-DCURL_STATICLIB=1)
+FIND_PACKAGE(CURL CONFIG)
 INCLUDE_DIRECTORIES(${CURL_INCLUDE_DIRS})
 
 # Define a test flag for have curl library
@@ -2466,8 +2478,9 @@ ENDIF()
 
 STRING(REPLACE ";" " " LINKFLAGS "${LINKFLAGS}")
 
-LIST(REMOVE_DUPLICATES NC_LIBS)
+LIST(REMOVE_ITEM LINKFLAGS "-L")
 LIST(REMOVE_DUPLICATES LINKFLAGS)
+STRING(REPLACE ";" " " LINKFLAGS "${LINKFLAGS}")
 
 SET(LIBS ${NC_LIBS})
 SET(NC_LIBS "-lnetcdf")
diff --git a/liblib/CMakeLists.txt b/liblib/CMakeLists.txt
index 9567167..014bfaf 100644
--- a/liblib/CMakeLists.txt
+++ b/liblib/CMakeLists.txt
@@ -103,6 +103,12 @@ IF(ENABLE_NCZARR_ZIP)
 ENDIF()
 
 IF(USE_HDF5)
+  if(TARGET hdf5::hdf5-shared)
+    SET(TLL_LIBS ${TLL_LIBS} hdf5::hdf5-shared hdf5::hdf5_hl-shared)
+  else()
+    SET(TLL_LIBS ${TLL_LIBS} hdf5::hdf5-static hdf5::hdf5_hl-static)
+  endif()
+elseif(0)
   IF(NOT MSVC)
     # Some version of cmake define HDF5_hdf5_LIBRARY instead of
     # HDF5_LIBRARY. Same with HDF5_HL_LIBRARIES
@@ -123,7 +129,7 @@ IF(USE_HDF5)
 ENDIF()
 
 IF(FOUND_CURL)
-  SET(TLL_LIBS ${TLL_LIBS} ${CURL_LIBRARIES})
+  SET(TLL_LIBS ${TLL_LIBS} CURL::libcurl)
 ENDIF()
 
 IF(USE_HDF4)
@@ -152,7 +158,6 @@ IF(NOT WIN32)
 ENDIF()
 
 IF(TLL_LIBS)
-  LIST(REMOVE_DUPLICATES TLL_LIBS)
 ENDIF()
 
 TARGET_LINK_LIBRARIES(netcdf ${TLL_LIBS})
diff --git a/netCDFConfig.cmake.in b/netCDFConfig.cmake.in
index 9d68eec..b3be259 100644
--- a/netCDFConfig.cmake.in
+++ b/netCDFConfig.cmake.in
@@ -12,6 +12,9 @@ set_and_check(netCDF_LIB_DIR "@PACKAGE_CMAKE_INSTALL_LIBDIR@")
 set(netCDF_LIBRARIES netCDF::netcdf)
 
 # include target information
+include(CMakeFindDependencyMacro)
+find_dependency(HDF5 CONFIG)
+find_dependency(CURL CONFIG)
 include("${CMAKE_CURRENT_LIST_DIR}/netCDFTargets.cmake")
 
 # Compiling Options
