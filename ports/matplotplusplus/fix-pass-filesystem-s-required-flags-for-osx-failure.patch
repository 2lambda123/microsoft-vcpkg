diff --git a/cmake/FindFilesystem.cmake b/cmake/FindFilesystem.cmake
index 7547e3f..ccdb3de 100644
--- a/cmake/FindFilesystem.cmake
+++ b/cmake/FindFilesystem.cmake
@@ -128,6 +128,9 @@ set(CMAKE_REQUIRED_QUIET ${Filesystem_FIND_QUIETLY})
 # All of our tests required C++17 or later
 if(NOT DEFINED CMAKE_CXX_STANDARD OR CMAKE_CXX_STANDARD LESS 17)
     set(CMAKE_CXX_STANDARD 17)
+    if (NOT DEFINED CMAKE_REQUIRED_FLAGS)
+        set(CMAKE_REQUIRED_FLAGS "-std=c++17")
+    endif()
 endif()

 # Normalize and check the component list we were given
@@ -154,7 +157,7 @@ if(NOT "Experimental" IN_LIST want_components)
 endif()

 if(find_final)
-    check_include_file_cxx("filesystem" _CXX_FILESYSTEM_HAVE_HEADER)
+    check_include_file_cxx("filesystem" _CXX_FILESYSTEM_HAVE_HEADER CMAKE_REQUIRED_FLAGS ${CMAKE_REQUIRED_FLAGS})
     mark_as_advanced(_CXX_FILESYSTEM_HAVE_HEADER)
     if(_CXX_FILESYSTEM_HAVE_HEADER)
         # We found the non-experimental header. Don't bother looking for the
--
2.34.1
