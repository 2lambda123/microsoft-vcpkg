diff --git a/src/CMakeLists.txt b/src/CMakeLists.txt
index d9f3a37..ce9712c 100644
--- a/src/CMakeLists.txt
+++ b/src/CMakeLists.txt
@@ -354,9 +354,9 @@ target_include_directories(libssh2 PRIVATE ${CMAKE_CURRENT_BINARY_DIR})
 # Daniel's note: this should not be necessary and we need to work to
 # get this removed.
 if(${CMAKE_SYSTEM_NAME} STREQUAL "Windows" OR ${CMAKE_SYSTEM_NAME} STREQUAL "WindowsStore")
-  target_compile_definitions(libssh2 PRIVATE LIBSSH2_WIN32)
+  target_compile_definitions(libssh2 PRIVATE LIBSSH2_WIN32 _WINDLL)
 elseif(${CMAKE_SYSTEM_NAME} STREQUAL "Darwin")
-  target_compile_definitions(libssh2 PRIVATE LIBSSH2_DARWIN)
+  target_compile_definitions(libssh2 PRIVATE LIBSSH2_DARWIN _WINDLL)
 endif()
 
 if(MSVC)
