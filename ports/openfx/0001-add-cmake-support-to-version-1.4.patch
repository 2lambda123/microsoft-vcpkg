From e2bf1da1740ea3147eae04847c20f2ca40678039 Mon Sep 17 00:00:00 2001
From: Reza Alizadeh Majd <r.a.majd@gmail.com>
Date: Sun, 24 Mar 2024 21:32:54 +0330
Subject: [PATCH] add cmake support to version 1.4

---
 CMakeLists.txt         | 58 ++++++++++++++++++++++++++++++++++++++++++
 Support/CMakeLists.txt | 21 +++++++++++++++
 2 files changed, 79 insertions(+)
 create mode 100644 CMakeLists.txt
 create mode 100644 Support/CMakeLists.txt

diff --git a/CMakeLists.txt b/CMakeLists.txt
new file mode 100644
index 0000000..b635cd3
--- /dev/null
+++ b/CMakeLists.txt
@@ -0,0 +1,58 @@
+cmake_minimum_required(VERSION 3.20)
+
+project(openfx VERSION 1.4.0 LANGUAGES CXX)
+
+set(CMAKE_CXX_STANDARD 11)
+set(CMAKE_CXX_STANDARD_REQUIRED ON)
+
+if(WIN32)
+    add_compile_definitions(WINDOWS)
+    add_compile_options(/DNOMINMAX)
+    add_definitions(-DWIN64)
+    set(OS_VAR "windows")
+    set(OFX_ARCH_NAME "Win64")
+endif()
+
+set(OFX_HEADERS_DIR ${CMAKE_CURRENT_SOURCE_DIR}/include CACHE INTERNAL "OFX_HEADERS_DIR")
+include_directories(${OFX_HEADERS_DIR})
+
+add_library(OpenFx INTERFACE)
+
+add_subdirectory(Support)
+
+install(
+    TARGETS OpenFx OfxSupport
+    EXPORT openfx-export
+    LIBRARY DESTINATION lib
+    ARCHIVE DESTINATION lib
+)
+
+install(
+    EXPORT openfx-export
+    FILE openfxTargets.cmake
+    NAMESPACE OpenFx::
+    DESTINATION "lib/cmake/openfx"
+)
+
+install(
+    DIRECTORY ${OFX_HEADERS_DIR}/
+    DESTINATION include
+    FILES_MATCHING PATTERN "*.h"
+)
+install(
+    DIRECTORY ${OFX_SUPPORT_HEADERS_DIR}/
+    DESTINATION include
+    FILES_MATCHING PATTERN "*.h"
+)
+
+include(CMakePackageConfigHelpers)
+
+write_basic_package_version_file(
+    "${CMAKE_CURRENT_BINARY_DIR}/openfxConfigVersion.cmake"
+    VERSION ${PROJECT_VERSION}
+    COMPATIBILITY AnyNewerVersion
+)
+install(
+    FILES "${CMAKE_CURRENT_BINARY_DIR}/openfxConfigVersion.cmake"
+    DESTINATION "lib/cmake/openfx"
+)
\ No newline at end of file
diff --git a/Support/CMakeLists.txt b/Support/CMakeLists.txt
new file mode 100644
index 0000000..0116ac7
--- /dev/null
+++ b/Support/CMakeLists.txt
@@ -0,0 +1,21 @@
+add_library(OfxSupport STATIC
+    Library/ofxsCore.cpp
+    Library/ofxsImageEffect.cpp
+    Library/ofxsInteract.cpp
+    Library/ofxsLog.cpp
+    Library/ofxsMultiThread.cpp
+    Library/ofxsParams.cpp
+    Library/ofxsProperty.cpp
+    Library/ofxsPropertyValidation.cpp
+)
+
+set(OFX_SUPPORT_HEADERS_DIR ${CMAKE_CURRENT_SOURCE_DIR}/include CACHE INTERNAL "OFX_SUPPORT_HEADERS_DIR")
+target_include_directories(OfxSupport
+    PUBLIC
+    $<BUILD_INTERFACE:${OFX_SUPPORT_HEADERS_DIR}>
+    $<INSTALL_INTERFACE:include>
+)
+
+target_link_libraries(OfxSupport PUBLIC OpenFx)
+
+target_compile_features(OfxSupport PUBLIC cxx_std_11)
-- 
2.44.0

