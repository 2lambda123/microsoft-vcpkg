From 800a4ad417a0bc7efd2d9595b4d6bed1f2d4e728 Mon Sep 17 00:00:00 2001
From: Amin Yahyaabadi <aminyahyaabadi74@gmail.com>
Date: Fri, 1 Dec 2023 03:29:57 -0800
Subject: [PATCH] build: link Freetype for juce_graphics

---
 extras/Build/CMake/JUCEModuleSupport.cmake | 9 +++++++++
 extras/Build/juceaide/CMakeLists.txt       | 7 +++++++
 2 files changed, 16 insertions(+)

diff --git a/extras/Build/CMake/JUCEModuleSupport.cmake b/extras/Build/CMake/JUCEModuleSupport.cmake
index e18dd5e08..1c6d24cd4 100644
--- a/extras/Build/CMake/JUCEModuleSupport.cmake
+++ b/extras/Build/CMake/JUCEModuleSupport.cmake
@@ -542,6 +542,15 @@ function(juce_add_module module_path)
         target_link_libraries(${module_name} INTERFACE oboe)
     endif()
 
+    if((${module_name} STREQUAL "juce_graphics"))
+        if(DEFINED JUCE_USE_FREETYPE AND JUCE_USE_FREETYPE AND CMAKE_SYSTEM_NAME STREQUAL "Linux")
+            find_package(Freetype)
+            if(TARGET Freetype::Freetype)
+                target_link_libraries(${module_name} INTERFACE Freetype::Freetype)
+            endif()
+        endif()
+    endif()
+
     if((${module_name} STREQUAL "juce_opengl") AND (CMAKE_SYSTEM_NAME STREQUAL "Android"))
         set(platform_supports_gl3 0)
 
diff --git a/extras/Build/juceaide/CMakeLists.txt b/extras/Build/juceaide/CMakeLists.txt
index 163f203cc..321666de3 100644
--- a/extras/Build/juceaide/CMakeLists.txt
+++ b/extras/Build/juceaide/CMakeLists.txt
@@ -148,6 +148,13 @@ else()
     set(JUCE_TOOL_INSTALL_DIR "bin/JUCE-${JUCE_VERSION}" CACHE STRING
         "The location, relative to the install prefix, where juceaide will be installed")
 
+    if(DEFINED JUCE_USE_FREETYPE AND JUCE_USE_FREETYPE AND CMAKE_SYSTEM_NAME STREQUAL "Linux")
+        find_package(Freetype)
+        if(TARGET Freetype::Freetype)
+            target_link_libraries(juceaide INTERFACE Freetype::Freetype)
+        endif()
+    endif()
+
     install(PROGRAMS "${imported_location}" DESTINATION "${JUCE_TOOL_INSTALL_DIR}")
 
     get_filename_component(binary_name "${imported_location}" NAME)
-- 
2.34.1

