diff --git a/cmake_modules/ThirdpartyToolchain.cmake b/cmake_modules/ThirdpartyToolchain.cmake
index 47c1a65ba..8570b6069 100644
--- a/cmake_modules/ThirdpartyToolchain.cmake
+++ b/cmake_modules/ThirdpartyToolchain.cmake
@@ -73,2 +73,4 @@ endif ()
 
+find_package(Snappy CONFIG REQUIRED)
+if (0)
 if (NOT "${SNAPPY_HOME}" STREQUAL "")
@@ -113,2 +115,3 @@ if (SNAPPY_VENDORED)
 endif ()
+endif ()
 
@@ -117,2 +120,4 @@ endif ()
 
+find_package(ZLIB REQUIRED)
+if (0)
 if (NOT "${ZLIB_HOME}" STREQUAL "")
@@ -165,2 +170,3 @@ if (ZLIB_VENDORED)
 endif ()
+endif ()
 
@@ -169,2 +175,4 @@ endif ()
 
+find_package(zstd CONFIG REQUIRED)
+if (0)
 if (NOT "${ZSTD_HOME}" STREQUAL "")
@@ -224,2 +232,3 @@ if (ZSTD_VENDORED)
 endif ()
+endif ()
 
@@ -228,2 +237,4 @@ endif ()
 
+find_package(lz4 CONFIG REQUIRED)
+if (0)
 if (NOT "${LZ4_HOME}" STREQUAL "")
@@ -276,2 +287,3 @@ if (LZ4_VENDORED)
 endif ()
+endif ()
 
@@ -280,3 +292,3 @@ endif ()
 
-if (WIN32)
+if (WIN32 AND TEST_VALGRIND_MEMCHECK)
   SET(CURRENT_TZDATA_FILE "")
@@ -383,2 +395,4 @@ endif ()
 
+find_package(Protobuf CONFIG REQUIRED)
+if (0)
 if (NOT "${PROTOBUF_HOME}" STREQUAL "")
@@ -454,2 +468,3 @@ if (PROTOBUF_VENDORED)
 endif ()
+endif ()
 
