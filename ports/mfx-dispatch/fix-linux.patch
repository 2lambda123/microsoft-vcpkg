diff --git a/CMakeLists.txt b/CMakeLists.txt
index a8a3288..aff7320 100644
--- a/CMakeLists.txt
+++ b/CMakeLists.txt
@@ -5,20 +5,28 @@ project( libmfx )
 # FIXME Adds support for using system/other install of intel media sdk
 set(INTELMEDIASDK_PATH "${CMAKE_CURRENT_LIST_DIR}")
 
-set(SOURCES
-  src/main.cpp
-  src/mfx_dispatcher.cpp
-  src/mfx_dispatcher_log.cpp
-  src/mfx_function_table.cpp
+add_definitions(
+    -DMINGW_HAS_SECURE_API=1
+    -DMFX_MODULES_DIR=\".\"
+    -DMFX_PLUGINS_CONF_DIR=\".\"
 )
 
-if (CMAKE_SYSTEM_NAME MATCHES "Linux")
-  add_definitions(-fPIC)
+if (CMAKE_SYSTEM_NAME MATCHES "Windows")
+  set(SOURCES
+    src/main.cpp
+    src/mfx_dispatcher.cpp
+    src/mfx_dispatcher_log.cpp
+    src/mfx_function_table.cpp
+  )
+else()
   list(APPEND SOURCES
-    src/mfx_library_iterator_linux.cpp
-    src/mfx_load_dll_linux.cpp
-    src/mfx_critical_section_linux.cpp
+    src/mfxloader.cpp
+    src/mfxparser.cpp
   )
+endif()
+
+if (CMAKE_SYSTEM_NAME MATCHES "Linux")
+  add_definitions(-fPIC)
 endif (CMAKE_SYSTEM_NAME MATCHES "Linux")
 
 if (CMAKE_SYSTEM_NAME MATCHES "Windows")
